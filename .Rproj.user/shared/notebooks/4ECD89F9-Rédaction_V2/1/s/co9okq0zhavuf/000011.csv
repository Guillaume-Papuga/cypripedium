"0","      #Il manque des informations"
"0",""
"0","# Ajouter la variable individuelle complète"
"0","data_original_obs <- data_original4 %>% "
"0","  mutate(id_ind_fin = paste(ID_ind, session, sep = ""."")) %>% "
"0","  dplyr::select(id_ind_fin, everything())"
"0",""
"0","# Prendre en compte le stade phénologique observé par observateurs"
"0","verification3 <- verification2 %>% "
"0","  pivot_longer("
"0","    cols = c(juv, non_fleuri, fleur, fleurs_fanees, fruit),"
"0","    names_to = ""phenologie"","
"0","    values_to = ""presence"""
"0","  )  "
"0","  "
"0","# Garder seulement la phénologie observée par observateurs"
"0","verification_obs <- verification3 %>% "
"0","  filter(presence == 1)"
"0","  "
"0","# Vérifier le nombre individus"
"0","str(unique(verification_obs$id_ind_fin))"
"1"," chr [1:1140] "
"1",""
"1","""VC.Q1.46.1"" ""VC.Q1.75.1"" ""VC.Q1.97.1"""
"1",""
"1"," ..."
"1",""
"1","
"
"0","str(unique(data_original_obs$id_ind_fin))"
"1"," chr [1:1353] "
"1",""
"1","""VaR.Q4.18.1"" ""VaR.Q4.18.2"" ""VaR.Q4.18.3"""
"1",""
"1"," ..."
"1",""
"1","
"
"0","str(data_original_obs$id_ind_fin)"
"1"," chr [1:1353] "
"1",""
"1","""VaR.Q4.18.1"" ""VaR.Q4.18.2"" ""VaR.Q4.18.3"""
"1",""
"1"," ..."
"1",""
"1","
"
"0","str(verification_obs$id_ind_fin)"
"1"," chr [1:4394] "
"1",""
"1","""VC.Q1.46.1"" ""VC.Q1.75.1"" ""VC.Q1.97.1"""
"1",""
"1"," ..."
"1",""
"1","
"
"0","    # À priori, 66 individus jamais observés par les observateurs"
"0",""
"0","# Extraire la liste de tous les individus"
"0","nb_individu <- data.frame(id_ind_fin = data_original_obs$id_ind_fin)"
"0",""
"0","# Extraire la liste des individus dans le test de détection"
"0","nb_ind_obs <- data.frame(id_ind_fin = unique(verification_obs$id_ind_fin))"
"0",""
"0","# Extraire les individus manquants"
"0","nb_individu_manquant <- nb_individu %>% "
"0","  anti_join(nb_ind_obs, by = ""id_ind_fin"")"
"0",""
"0","# Reprendre les données originales sur les valeurs manquantes"
"0","nb_individu_manquant_original <- data_original_obs %>% "
"0","  semi_join(nb_individu_manquant, by = ""id_ind_fin"") "
"0","  "
"0","# Joindre à ces données manquantes les valeurs du tableau observateurs"
"0","nb_individu_manquant_final <- nb_individu_manquant_original %>% "
"0","  left_join(verification_obs, by = ""id_ind_fin"") %>% "
"0","  dplyr::select(-ends_with("".y"")) %>% "
"0","  rename_with(~ sub(""\\.x$"", """", .x), ends_with("".x""))"
"0",""
"0","# Joindre au fichier original les informations des évaluateurs"
"0","data_verification_original <- verification_obs %>% "
"0","  left_join(data_original_obs, by = ""id_ind_fin"") %>% "
"0","  dplyr::select(-ends_with("".y"")) %>% "
"0","  rename_with(~ sub(""\\.x$"", """", .x), ends_with("".x""))"
"0",""
"0","# Mettre les colomnes dans le bon ordre"
"0","nb_individu_manquant_final <- nb_individu_manquant_final %>% "
"0","  dplyr::select(id_ind_fin, session, site, date, numero_quadrat, ID_quadrat, marquage, ID_ind, observateur, adequation, phenologie, presence, quadrat, phenologie_verif, taille)"
"0",""
"0","# Joindre ces données manquantes à tableau observateurs"
"0","tab_detection <- rbind(data_verification_original, nb_individu_manquant_final)"
"0",""
"0","# Créer nouvelle valeur adéquation"
"0","tab_detection <- tab_detection %>% "
"0","  mutate(adequation_reel = if_else("
"0","    phenologie == phenologie_verif, 1, 0),"
"0","  comparaison_adequation = if_else("
"0","    adequation_reel==adequation, 1, 0 ) )"
"0",""
"0","# Taux d'erreur dans note d'adéquation"
"0","sum(tab_detection$comparaison_adequation == 0, na.rm = T) / nrow(tab_detection)"
"1","[1]"
"1"," 0.01910137"
"1","
"
"0","# Vérifier le nombre d'observateurs par session et par quadrat"
"0","nb_verif_quadrat <- verification %>% "
"0","  group_by(session, site, numero_quadrat) %>% "
"0","  summarise("
"0","    nb_observateurs = n_distinct(observateur),"
"0","    .groups = ""drop"""
"0","  )"
"0","nrow(nb_verif_quadrat)"
"1","[1]"
"1"," 81"
"1","
"
"0","nb_verif_quadrat <- nb_verif_quadrat %>% "
"0","  mutate(site = case_when("
"0","    site == ""Combe Michaut"" ~ ""CM"","
"0","    site == ""Tete Cendree Bas"" ~ ""TCb"","
"0","    site == ""Tete Cendree Haut"" ~ ""TCh"","
"0","    site == ""Vigne au Renard"" ~ ""VaR"","
"0","    site == ""Val Clavin"" ~ ""VC"""
"0","  ),"
"0","  ID = ""Q"")"
"0",""
"0","nb_verif_quadrat <- nb_verif_quadrat %>% "
"0","  mutate(id_quadrat = paste(ID, numero_quadrat, sep = """"),"
"0","         id_quadrat_fin = paste(site, id_quadrat, session, sep =""."")) %>% "
"0","  dplyr::select(id_quadrat_fin, everything())"
"0",""
"0","nb_obs_quadrat <- data_original_obs %>% "
"0","  group_by(session, site, quadrat) %>% "
"0","  count()"
"0","nrow(nb_obs_quadrat)"
"1","[1]"
"1"," 81"
"1","
"
"0","nb_quadrat_final <- tab_detection %>% "
"0","  group_by(session, site, quadrat) %>% "
"0","  summarise("
"0","    nb_observateurs = n_distinct(observateur),"
"0","    .groups = ""drop"""
"0","  ) %>% "
"0","  filter(!is.na(quadrat))"
"0","nrow(nb_quadrat_final)"
"1","[1]"
"1"," 81"
"1","
"
"0","nb_quadrat_manquant <- nb_individu_manquant_final %>% "
"0","  group_by(session, ID_quadrat) %>% "
"0","  summarise("
"0","    nb_observateurs = n_distinct(observateur),"
"0","    .groups = ""drop"""
"0","  )"
"0","nrow(nb_quadrat_manquant)"
"1","[1]"
"1"," 39"
"1","
"
"0","    #individus manquants dans 39 quadras"
"0",""
"0","nb_quadrat_manquant <- nb_quadrat_manquant %>% "
"0","  mutate(id_quadrat_fin = paste(ID_quadrat, session, sep = ""."")) %>% "
"0","  dplyr::select(id_quadrat_fin, everything())"
"0",""
"0","test <- nb_quadrat_manquant %>% "
"0","  anti_join(nb_verif_quadrat, by = ""id_quadrat_fin"")"
"0",""
"0","# Nous avons bien tous les quadrat observés, juste pas tous les individus"
"0",""
"0","str(tab_detection)"
"1","tibble [4,607 × 17]"
"1",""
"1"," (S3: "
"1",""
"1","tbl_df/tbl/data.frame"
"1",""
"1",")"
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","id_ind_fin            "
"1",""
"1",":"
"1"," chr [1:4607] "
"1",""
"1","""VC.Q1.46.1"" ""VC.Q1.75.1"" ""VC.Q1.97.1"" ""VC.Q1.17.1"""
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","session               "
"1",""
"1",":"
"1"," num [1:4607] "
"1",""
"1","1 1 1 1 1 1 1 1 1 1"
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","site                  "
"1",""
"1",":"
"1"," chr [1:4607] "
"1",""
"1","""Val Clavin"" ""Val Clavin"" ""Val Clavin"" ""Val Clavin"""
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","date                  "
"1",""
"1",":"
"1"," chr [1:4607] "
"1",""
"1","""22/05/2024"" ""22/05/2024"" ""22/05/2024"" ""22/05/2024"""
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","numero_quadrat        "
"1",""
"1",":"
"1"," int [1:4607] "
"1",""
"1","1 1 1 1 5 5 5 5 5 5"
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","ID_quadrat            "
"1",""
"1",":"
"1"," chr [1:4607] "
"1",""
"1","""VC.Q1"" ""VC.Q1"" ""VC.Q1"" ""VC.Q1"""
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","marquage              "
"1",""
"1",":"
"1"," int [1:4607] "
"1",""
"1","46 75 97 17 96 94 8 62 42 10"
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","ID_ind                "
"1",""
"1",":"
"1"," chr [1:4607] "
"1",""
"1","""VC.Q1.46"" ""VC.Q1.75"" ""VC.Q1.97"" ""VC.Q1.17"""
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","observateur           "
"1",""
"1",":"
"1"," chr [1:4607] "
"1",""
"1","""Damien NICOLAS"" ""Damien NICOLAS"" ""Damien NICOLAS"" ""Damien NICOLAS"""
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","adequation            "
"1",""
"1",":"
"1"," int [1:4607] "
"1",""
"1","1 1 1 1 1 1 1 1 1 0"
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","phenologie            "
"1",""
"1",":"
"1"," chr [1:4607] "
"1",""
"1","""fleur"" ""non_fleuri"" ""non_fleuri"" ""non_fleuri"""
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","presence              "
"1",""
"1",":"
"1"," int [1:4607] "
"1",""
"1","1 1 1 1 1 1 1 1 1 1"
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","quadrat               "
"1",""
"1",":"
"1"," int [1:4607] "
"1",""
"1","1 1 1 1 5 5 5 5 5 5"
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","phenologie_verif      "
"1",""
"1",":"
"1"," chr [1:4607] "
"1",""
"1","""fleur"" ""non_fleuri"" ""non_fleuri"" ""non_fleuri"""
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","taille                "
"1",""
"1",":"
"1"," chr [1:4607] "
"1",""
"1","""34"" ""26"" ""27"" ""20"""
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","adequation_reel       "
"1",""
"1",":"
"1"," num [1:4607] "
"1",""
"1","1 1 1 1 1 1 1 1 1 0"
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","comparaison_adequation"
"1",""
"1",":"
"1"," num [1:4607] "
"1",""
"1","1 1 1 1 1 1 1 1 1 1"
"1",""
"1"," ..."
"1",""
"1","
"
"0","# Pour le moment, on obtient un tableau avec tous les individus observés, mais sans l'information sur les individus non observés par les observateurs."
"0","# Il faut, à chaque fois, le nombre de quadrats observés par observateur pour pouvoir calculer le nombre d'observateurs par quadrat."
"0",""
"0","verification_obs_quadrat <- verification %>% "
"0","  mutate(id_quadrat_fin = paste(ID_quadrat, session, sep = ""."")) %>% "
"0","  group_by(id_quadrat_fin, observateur) %>% "
"0","  count()"
"0",""
"0","# Ajouter à tableau détection : id_quadrat_fin"
"0","tab_detection <- tab_detection %>% "
"0","  mutate(id_quadrat_fin = paste(ID_quadrat, session, sep = "".""))"
"0",""
"0","# Vérifier qu'il n'y pas de NA crées"
"0","tab_detection[is.na(tab_detection$id_quadrat_fin), ]"
