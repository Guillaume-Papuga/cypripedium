---
title: "Fourtier_cypripedium"
author: "Galadriel"
format: html
editor: visual
---

## Chargement des packages

```{r}
library(tidyverse)
library(MASS)
library(ade4)
```

## Ouverture des tableaux de données

```{r}
recouvrement <- read.csv("data/raw/Recouvrement VF.csv",sep = ";")
```

###Visualisation des données ####Pour chaque strate de recouvrement

***Strate muscilagineuse***

```{r}
#| echo: false
ggplot(recouvrement, aes(x = Quadrat, y = S_muscinale, color = Site))+
  geom_line()

```

***Strate herbacéee***

```{r}
#| echo: false
ggplot(recouvrement, aes(x = Quadrat, y = S_herbacee, color = Site))+
  geom_line()

```

***Strate arbustive basse***

```{r}
#| echo: false
ggplot(recouvrement, aes(x = Quadrat, y = S_arbustive_basse, color = Site))+
  geom_line()

```

***Strate arbustive haute***

```{r}
#| echo: false
ggplot(recouvrement, aes(x = Quadrat, y = S_arbustive_haute, color = Site))+
  geom_line()

```

***Strate arborescente***

```{r}
#| echo: false
ggplot(recouvrement, aes(x = Quadrat, y = S_arborescente, color = Site))+
  geom_line()
```

## Transformation strates en facteur

```{r}
recouvrement_par_strate <- recouvrement %>%
  pivot_longer(
    cols = c(-Site, -Quadrat, -ID_Quadrat, starts_with("S_")),
    names_to = "Strate",
    values_to = "Recouvrement"
  ) %>% 
  arrange(Strate)
  
```

###Visualisation des données ####Pour chaque site

***Combe Michaut***

```{r}
#| echo: false
recouvrement_par_strate %>% 
  filter(Site == "Combe Michaut") %>%
  ggplot(aes(x = factor(Quadrat), y = Recouvrement, color = Strate))+
  geom_point(position= "dodge") 

```

***Val Clavin***

```{r}
#| echo: false
recouvrement_par_strate %>% 
  filter(Site == "Val Clavin") %>%
  ggplot(aes(x = factor(Quadrat), y = Recouvrement, color = Strate))+
  geom_point(position= "dodge") 

```

***Vigne au Renard***

```{r}
#| echo: false
recouvrement_par_strate %>% 
  filter(Site == "Vigne au Renard") %>%
  ggplot(aes(x = factor(Quadrat), y = Recouvrement, color = Strate))+
  geom_point(position= "dodge") 

```

***Tete cendree haut***

```{r}
#| echo: false
recouvrement_par_strate %>% 
  filter(Site == "Tete cendree haut") %>%
  ggplot(aes(x = factor(Quadrat), y = Recouvrement, color = Strate))+
  geom_point(position= "dodge") 

```

####Pour tous les sites

```{r}
#| echo: false
ggplot(recouvrement_par_strate, aes(x = Strate, y = Recouvrement, color = Site))+
  geom_boxplot(position= "dodge") 

```

```{r}
afd_recouvrement<-lda(Site~S_muscinale      +S_herbacee+S_arbustive_basse+S_arbustive_haute+S_arborescente   , data = recouvrement)

#on centre et norme les données
newdata<-as.data.frame(scale(recouvrement[,4:8])) 
names(newdata)
attach(recouvrement)
afd2<-lda(Site~S_muscinale      +S_herbacee+S_arbustive_basse+S_arbustive_haute+S_arborescente   , data = newdata)
afd2
plot(afd2)
manova <- manova(as.matrix(recouvrement[,4:8])~Site)
summary(manova, "Pillai")
summary(manova, "Wilks")

pred<-predict(afd2)
names(pred)
table(Site,pred$class)

#- Validation par jacknife en utilisant CV=T

afd2= lda(Site~S_muscinale      +S_herbacee+S_arbustive_basse+S_arbustive_haute+S_arborescente   , data = newdata, CV=TRUE)
names(afd2)
table(Site, afd2$class)

afd3=discrimin(dudi.pca(recouvrement[,4:8],scannf=F, nf = 3),factor(Site)) # se base sur une ACP centrée réduite et permet d'avoir des coéfficients standardisés 
names(afd3)
afd3$eig # interpréter les ratios variabilité intergroupes/variabilité intragroupe
sqrt(afd3$eig/(1+afd3$eig))

# NB : la fonction discrimin () est différente de LDA : réalise une ACP sur les barycentres des groupes de l'ACP initial. 

s.arrow(afd3$fa) # projection des variables sur les fonctions discriminantes = coef standardisés

s.class(afd3$li, factor(Site)) # projection des individus regroupés en fonction des groupes d'appartendance

rand=rtest(afd3,1000) # MANOVA non paramétrique (test de Pillai non paramétrique)
plot(rand)

```
