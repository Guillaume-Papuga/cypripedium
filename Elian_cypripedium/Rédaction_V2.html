<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Rédaction_V1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Rédaction_V2_files/libs/clipboard/clipboard.min.js"></script>
<script src="Rédaction_V2_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="Rédaction_V2_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="Rédaction_V2_files/libs/quarto-html/popper.min.js"></script>
<script src="Rédaction_V2_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Rédaction_V2_files/libs/quarto-html/anchor.min.js"></script>
<link href="Rédaction_V2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Rédaction_V2_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Rédaction_V2_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Rédaction_V2_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Rédaction_V2_files/libs/bootstrap/bootstrap-bb462d781dde1847d9e3ccf7736099dd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="Rédaction_V2_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="Rédaction_V2_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<script src="Rédaction_V2_files/libs/plotly-binding-4.11.0/plotly.js"></script>

<script src="Rédaction_V2_files/libs/typedarray-0.1/typedarray.min.js"></script>

<script src="Rédaction_V2_files/libs/jquery-3.5.1/jquery.min.js"></script>

<link href="Rédaction_V2_files/libs/crosstalk-1.2.2/css/crosstalk.min.css" rel="stylesheet">

<script src="Rédaction_V2_files/libs/crosstalk-1.2.2/js/crosstalk.min.js"></script>

<link href="Rédaction_V2_files/libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">

<script src="Rédaction_V2_files/libs/plotly-main-2.11.1/plotly-latest.min.js"></script>

<script src="Rédaction_V2_files/libs/viz-1.8.2/viz.js"></script>

<link href="Rédaction_V2_files/libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">

<script src="Rédaction_V2_files/libs/grViz-binding-1.0.11/grViz.js"></script>



</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Rédaction_V1</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="chargement-des-packages" class="level1">
<h1>Chargement des packages</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.1     ✔ stringr   1.5.2
✔ ggplot2   4.0.0     ✔ tibble    3.3.0
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.1.0     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggalluvial)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: le package 'ggalluvial' a été compilé avec la version R 4.5.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MuMIn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: le package 'MuMIn' a été compilé avec la version R 4.5.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: le package 'lme4' a été compilé avec la version R 4.5.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Le chargement a nécessité le package : Matrix

Attachement du package : 'Matrix'

Les objets suivants sont masqués depuis 'package:tidyr':

    expand, pack, unpack</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stats)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: le package 'plotly' a été compilé avec la version R 4.5.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attachement du package : 'plotly'

L'objet suivant est masqué depuis 'package:ggplot2':

    last_plot

L'objet suivant est masqué depuis 'package:stats':

    filter

L'objet suivant est masqué depuis 'package:graphics':

    layout</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpmisc)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: le package 'ggpmisc' a été compilé avec la version R 4.5.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Le chargement a nécessité le package : ggpp</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: le package 'ggpp' a été compilé avec la version R 4.5.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 methods overwritten by 'ggpp':
  method                  from   
  heightDetails.titleGrob ggplot2
  widthDetails.titleGrob  ggplot2

Attachement du package : 'ggpp'

L'objet suivant est masqué depuis 'package:ggplot2':

    annotate</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)        </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attachement du package : 'MASS'

L'objet suivant est masqué depuis 'package:plotly':

    select

L'objet suivant est masqué depuis 'package:dplyr':

    select</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ade4)        </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vegan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Le chargement a nécessité le package : permute</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Le chargement a nécessité le package : carData

Attachement du package : 'car'

L'objet suivant est masqué depuis 'package:dplyr':

    recode

L'objet suivant est masqué depuis 'package:purrr':

    some</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RMark)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: le package 'RMark' a été compilé avec la version R 4.5.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>This is RMark 3.0.0
 Documentation available at http://www.phidot.org/software/mark/rmark/RMarkDocumentation.zip</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DiagrammeR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: le package 'DiagrammeR' a été compilé avec la version R 4.5.2</code></pre>
</div>
</div>
</section>
<section id="section" class="level1">
<h1>——————————-</h1>
</section>
<section id="ouverture-des-tableaux-de-données" class="level1">
<h1>Ouverture des tableaux de données</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tableau de recouvrement avec les strates</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>recouvrement <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/raw/Recouvrement VF.csv"</span>,<span class="at">sep =</span> <span class="st">";"</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(recouvrement<span class="sc">$</span>Site)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Combe Michaut"     "Val Clavin"        "Vigne au Renard"  
[4] "Tete cendree haut"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tableau de la détection individuelle vérifiée des observateurs </span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>verification <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/raw/detections_individuelles_verifsTC+LD_18dec.csv"</span>, <span class="at">sep =</span> <span class="st">";"</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Problème d'espace à régler pour verification</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(verification<span class="sc">$</span>site)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Val Clavin"        "Combe Michaut"     "Tete Cendree Bas" 
[4] "Tete Cendree Haut" "Vigne au Renard"   "Combe Michaut "   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>verification<span class="sc">$</span>site <span class="ot">&lt;-</span> <span class="fu">trimws</span>(verification<span class="sc">$</span>site)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(verification<span class="sc">$</span>site)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Val Clavin"        "Combe Michaut"     "Tete Cendree Bas" 
[4] "Tete Cendree Haut" "Vigne au Renard"  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>data_original <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/raw/Taille et phéno verif LD.csv"</span>, <span class="at">sep =</span> <span class="st">";"</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(data_original<span class="sc">$</span>site)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Vigne au Renard"   "Combe Michaut"     "Tête Cendrée Bas" 
[4] "Tête Cendrée Haut" "Val Clavin"       </code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">#enlever les accents</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>data_original <span class="ot">&lt;-</span> data_original <span class="sc">%&gt;%</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(site</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>         <span class="ot">=</span> <span class="fu">case_when</span>(</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    site <span class="sc">==</span> <span class="st">"Combe Michaut"</span> <span class="sc">~</span> <span class="st">"Combe Michaut"</span>,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    site <span class="sc">==</span> <span class="st">"Tête Cendrée Bas"</span> <span class="sc">~</span> <span class="st">"Tete Cendree Bas"</span>,</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    site <span class="sc">==</span> <span class="st">"Tête Cendrée Haut"</span> <span class="sc">~</span> <span class="st">"Tete Cendree Haut"</span>,</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    site <span class="sc">==</span> <span class="st">"Vigne au Renard"</span> <span class="sc">~</span> <span class="st">"Vigne au Renard"</span>,</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    site <span class="sc">==</span> <span class="st">"Val Clavin"</span> <span class="sc">~</span> <span class="st">"Val Clavin"</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(data_original<span class="sc">$</span>site)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Vigne au Renard"   "Combe Michaut"     "Tete Cendree Bas" 
[4] "Tete Cendree Haut" "Val Clavin"       </code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tableau réponse questionnaire expérience individuelle des observateurs</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>experience <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/raw/Experience_des_observateurs_VF.csv"</span>, <span class="at">sep =</span> <span class="st">";"</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Rajouter la colonne sexe au tableau</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>experience<span class="sc">$</span>sexe <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"m"</span>,<span class="st">"f"</span>,<span class="st">"m"</span>,<span class="st">"m"</span>,<span class="st">"m"</span>,<span class="st">"f"</span>,<span class="st">"m"</span>,<span class="st">"m"</span>,<span class="st">"m"</span>,<span class="st">"f"</span>,<span class="st">"f"</span>,<span class="st">"f"</span>,<span class="st">"f"</span>,<span class="st">"m"</span>,<span class="st">"f"</span>,<span class="st">"m"</span>,<span class="st">"m"</span>,<span class="st">"m"</span>,<span class="st">"m"</span>,<span class="st">"m"</span>,<span class="st">"f"</span>,<span class="st">"f"</span>,<span class="st">"f"</span>,<span class="st">"m"</span>,<span class="st">"f"</span>,<span class="st">"m"</span>,<span class="st">"f"</span>,<span class="st">"m"</span>,<span class="st">"f"</span>,<span class="st">"f"</span>,<span class="st">"f"</span>,<span class="st">"m"</span>,<span class="st">"f"</span>,<span class="st">"f"</span>,<span class="st">"m"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-1" class="level1">
<h1>——————————-</h1>
</section>
<section id="compilation-tableau-complet" class="level1">
<h1>Compilation tableau complet</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ajout information session à l'ID individuel####</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co">#pour tableau vérification des observateurs</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>verification2<span class="ot">&lt;-</span> verification <span class="sc">%&gt;%</span> </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id_ind_fin =</span> <span class="fu">paste</span>(ID_ind, session, <span class="at">sep =</span> <span class="st">"."</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(id_ind_fin, <span class="fu">everything</span>())</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co">#pour tableau des évaluateurs</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="do">##mettre stade phéno en ligne et non en colonne </span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>data_original2 <span class="ot">&lt;-</span> data_original <span class="sc">%&gt;%</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>tailleS1, <span class="sc">-</span>tailleS2, <span class="sc">-</span>tailleS3, <span class="sc">-</span>nbfleurs, <span class="sc">-</span>nbfruits, <span class="sc">-</span>predation) <span class="sc">%&gt;%</span> </span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(phenoS1, phenoS2, phenoS3),</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"session"</span>,</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"phenologie_verif"</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">%&gt;%</span> </span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">session =</span> <span class="fu">case_when</span>(</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    session <span class="sc">==</span> <span class="st">"phenoS1"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    session <span class="sc">==</span> <span class="st">"phenoS2"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    session <span class="sc">==</span> <span class="st">"phenoS3"</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">%&gt;%</span> </span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(phenologie_verif</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>         <span class="ot">=</span> <span class="fu">case_when</span>(</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>    phenologie_verif <span class="sc">==</span> <span class="st">"j"</span> <span class="sc">~</span> <span class="st">"juv"</span>,</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>    phenologie_verif <span class="sc">==</span> <span class="st">"nf"</span> <span class="sc">~</span> <span class="st">"non_fleuri"</span>,</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>    phenologie_verif <span class="sc">==</span> <span class="st">"f"</span> <span class="sc">~</span> <span class="st">"fleur"</span>,</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>    phenologie_verif <span class="sc">==</span> <span class="st">"ff"</span> <span class="sc">~</span> <span class="st">"fleurs_fanees"</span>,</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>    phenologie_verif <span class="sc">==</span> <span class="st">"F"</span> <span class="sc">~</span><span class="st">"fruit"</span></span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a><span class="do">##mettre taille en ligne et non en colonne</span></span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>data_original3 <span class="ot">&lt;-</span> data_original <span class="sc">%&gt;%</span> </span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(tailleS1, tailleS2, tailleS3) <span class="sc">%&gt;%</span> </span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(tailleS1, tailleS2, tailleS3),</span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"session"</span>,</span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"taille"</span></span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">session =</span> <span class="fu">case_when</span>(</span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>    session <span class="sc">==</span> <span class="st">"tailleS1"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a>    session <span class="sc">==</span> <span class="st">"tailleS2"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a>    session <span class="sc">==</span> <span class="st">"tailleS3"</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a><span class="co">#enlever session car déjà présent sur autre data frame</span></span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a>data_original3 <span class="ot">&lt;-</span> data_original3 <span class="sc">%&gt;%</span> </span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>session)</span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a><span class="co">#ajout des deux tableaux + enlever lignes sans info  à cause d'observation d'un individu à partir de session 2 ou 3</span></span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a>data_original4 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(data_original2, data_original3) <span class="sc">%&gt;%</span> </span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(taille)) <span class="co">#enlever lignes avec pas d'infos</span></span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a><span class="co">#vérifier si manque des informations par rapport à phénologie</span></span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a>data_original4 <span class="sc">%&gt;%</span> </span>
<span id="cb40-55"><a href="#cb40-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(phenologie_verif))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] site             quadrat          ID_quadrat       marquage        
[5] ID_ind           session          phenologie_verif taille          
&lt;0 lignes&gt; (ou 'row.names' de longueur nulle)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ajout variable individuelle complète</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>data_original_obs <span class="ot">&lt;-</span> data_original4 <span class="sc">%&gt;%</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id_ind_fin =</span> <span class="fu">paste</span>(ID_ind, session, <span class="at">sep =</span> <span class="st">"."</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(id_ind_fin, <span class="fu">everything</span>())</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co">#prendre en compte stade phéno observé par observateur</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>verification3 <span class="ot">&lt;-</span> verification2 <span class="sc">%&gt;%</span> </span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(juv, non_fleuri, fleur, fleurs_fanees, fruit),</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"phenologie"</span>,</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"presence"</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  )  </span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="co">#garder seulement st phéno observé par observateur</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>verification_obs <span class="ot">&lt;-</span> verification3 <span class="sc">%&gt;%</span> </span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(presence <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Vérifier nb individus</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">unique</span>(verification_obs<span class="sc">$</span>id_ind_fin))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> chr [1:1140] "VC.Q1.46.1" "VC.Q1.75.1" "VC.Q1.97.1" "VC.Q1.17.1" ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">unique</span>(data_original_obs<span class="sc">$</span>id_ind_fin))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> chr [1:1204] "VaR.Q4.18.1" "VaR.Q4.18.2" "VaR.Q4.18.3" "VaR.Q4.180.1" ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data_original_obs<span class="sc">$</span>id_ind_fin)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> chr [1:1204] "VaR.Q4.18.1" "VaR.Q4.18.2" "VaR.Q4.18.3" "VaR.Q4.180.1" ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(verification_obs<span class="sc">$</span>id_ind_fin)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> chr [1:4394] "VC.Q1.46.1" "VC.Q1.75.1" "VC.Q1.97.1" "VC.Q1.17.1" ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co">#à priori 66 individus jamais vus par observateurs</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co">#extraire liste de tous les individus</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>nb_individu <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id_ind_fin =</span> data_original_obs<span class="sc">$</span>id_ind_fin)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="co">#extraire liste individus dans test de détection</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>nb_ind_obs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id_ind_fin =</span> <span class="fu">unique</span>(verification_obs<span class="sc">$</span>id_ind_fin))</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="co">#individus manquants</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>nb_individu_manquant <span class="ot">&lt;-</span> nb_individu <span class="sc">%&gt;%</span> </span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(nb_ind_obs, <span class="at">by =</span> <span class="st">"id_ind_fin"</span>)</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="co">#reprendre données originales sur les valeurs manquantes</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>nb_individu_manquant_original <span class="ot">&lt;-</span> data_original_obs <span class="sc">%&gt;%</span> </span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">semi_join</span>(nb_individu_manquant, <span class="at">by =</span> <span class="st">"id_ind_fin"</span>) </span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a><span class="co">#joindre à ces données manquantes les valeurs du tableau observateur</span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>nb_individu_manquant_final <span class="ot">&lt;-</span> nb_individu_manquant_original <span class="sc">%&gt;%</span> </span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(verification_obs, <span class="at">by =</span> <span class="st">"id_ind_fin"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">ends_with</span>(<span class="st">".y"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">sub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">.x$"</span>, <span class="st">""</span>, .x), <span class="fu">ends_with</span>(<span class="st">".x"</span>))</span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a><span class="co">#Joindre au fichier original les informations des évaluateurs</span></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>data_verification_original <span class="ot">&lt;-</span> verification_obs <span class="sc">%&gt;%</span> </span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(data_original_obs, <span class="at">by =</span> <span class="st">"id_ind_fin"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">ends_with</span>(<span class="st">".y"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">sub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">.x$"</span>, <span class="st">""</span>, .x), <span class="fu">ends_with</span>(<span class="st">".x"</span>))</span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a><span class="co">#mettre les colomnes dans le bon ordre</span></span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a>nb_individu_manquant_final <span class="ot">&lt;-</span> nb_individu_manquant_final <span class="sc">%&gt;%</span> </span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(id_ind_fin, session, site, date, numero_quadrat, ID_quadrat, marquage, ID_ind, observateur, adequation, phenologie, presence, quadrat, phenologie_verif, taille)</span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a><span class="co">#joindre ces données manquantes à tableau observateurs</span></span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a>tab_detection <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_verification_original, nb_individu_manquant_final)</span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a><span class="co">#créer nouvelle valeur adéquation</span></span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a>tab_detection <span class="ot">&lt;-</span> tab_detection <span class="sc">%&gt;%</span> </span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">adequation_reel =</span> <span class="fu">if_else</span>(</span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a>    phenologie <span class="sc">==</span> phenologie_verif, <span class="dv">1</span>, <span class="dv">0</span></span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">comparaison_adequation =</span> <span class="fu">if_else</span>(</span>
<span id="cb50-43"><a href="#cb50-43" aria-hidden="true" tabindex="-1"></a>    adequation_reel<span class="sc">==</span>adequation, <span class="dv">1</span>, <span class="dv">0</span></span>
<span id="cb50-44"><a href="#cb50-44" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb50-45"><a href="#cb50-45" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb50-46"><a href="#cb50-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-47"><a href="#cb50-47" aria-hidden="true" tabindex="-1"></a><span class="co">#Taux d'erreur dans note d'adéquation</span></span>
<span id="cb50-48"><a href="#cb50-48" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(tab_detection<span class="sc">$</span>comparaison_adequation <span class="sc">==</span> <span class="dv">0</span>, <span class="at">na.rm =</span> T) <span class="sc">/</span> <span class="fu">nrow</span>(tab_detection)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01973094</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">#vérifier nombre d'observateurs par session et par quadrat</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>nb_verif_quadrat <span class="ot">&lt;-</span> verification <span class="sc">%&gt;%</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(session, site, numero_quadrat) <span class="sc">%&gt;%</span> </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">nb_observateurs =</span> <span class="fu">n_distinct</span>(observateur),</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(nb_verif_quadrat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 81</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>nb_verif_quadrat <span class="ot">&lt;-</span> nb_verif_quadrat <span class="sc">%&gt;%</span> </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site =</span> <span class="fu">case_when</span>(</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    site <span class="sc">==</span> <span class="st">"Combe Michaut"</span> <span class="sc">~</span> <span class="st">"CM"</span>,</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    site <span class="sc">==</span> <span class="st">"Tete Cendree Bas"</span> <span class="sc">~</span> <span class="st">"TCb"</span>,</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    site <span class="sc">==</span> <span class="st">"Tete Cendree Haut"</span> <span class="sc">~</span> <span class="st">"TCh"</span>,</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    site <span class="sc">==</span> <span class="st">"Vigne au Renard"</span> <span class="sc">~</span> <span class="st">"VaR"</span>,</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    site <span class="sc">==</span> <span class="st">"Val Clavin"</span> <span class="sc">~</span> <span class="st">"VC"</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">ID =</span> <span class="st">"Q"</span>)</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>nb_verif_quadrat <span class="ot">&lt;-</span> nb_verif_quadrat <span class="sc">%&gt;%</span> </span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id_quadrat =</span> <span class="fu">paste</span>(ID, numero_quadrat, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">id_quadrat_fin =</span> <span class="fu">paste</span>(site, id_quadrat, session, <span class="at">sep =</span><span class="st">"."</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(id_quadrat_fin, <span class="fu">everything</span>())</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>nb_obs_quadrat <span class="ot">&lt;-</span> data_original_obs <span class="sc">%&gt;%</span> </span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(session, site, quadrat) <span class="sc">%&gt;%</span> </span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(nb_obs_quadrat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 81</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>nb_quadrat_final <span class="ot">&lt;-</span> tab_detection <span class="sc">%&gt;%</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(session, site, quadrat) <span class="sc">%&gt;%</span> </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">nb_observateurs =</span> <span class="fu">n_distinct</span>(observateur),</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(quadrat))</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(nb_quadrat_final)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 81</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>nb_quadrat_manquant <span class="ot">&lt;-</span> nb_individu_manquant_final <span class="sc">%&gt;%</span> </span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(session, ID_quadrat) <span class="sc">%&gt;%</span> </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">nb_observateurs =</span> <span class="fu">n_distinct</span>(observateur),</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(nb_quadrat_manquant)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 27</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">#individus manquants dans 27 quadras</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>nb_quadrat_manquant <span class="ot">&lt;-</span> nb_quadrat_manquant <span class="sc">%&gt;%</span> </span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id_quadrat_fin =</span> <span class="fu">paste</span>(ID_quadrat, session, <span class="at">sep =</span> <span class="st">"."</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(id_quadrat_fin, <span class="fu">everything</span>())</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> nb_quadrat_manquant <span class="sc">%&gt;%</span> </span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(nb_verif_quadrat, <span class="at">by =</span> <span class="st">"id_quadrat_fin"</span>)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="co">#On a bien tous les quadra d'observés juste pas tous les individus</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(tab_detection)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [4,460 × 17] (S3: tbl_df/tbl/data.frame)
 $ id_ind_fin            : chr [1:4460] "VC.Q1.46.1" "VC.Q1.75.1" "VC.Q1.97.1" "VC.Q1.17.1" ...
 $ session               : num [1:4460] 1 1 1 1 1 1 1 1 1 1 ...
 $ site                  : chr [1:4460] "Val Clavin" "Val Clavin" "Val Clavin" "Val Clavin" ...
 $ date                  : chr [1:4460] "22/05/2024" "22/05/2024" "22/05/2024" "22/05/2024" ...
 $ numero_quadrat        : int [1:4460] 1 1 1 1 5 5 5 5 5 5 ...
 $ ID_quadrat            : chr [1:4460] "VC.Q1" "VC.Q1" "VC.Q1" "VC.Q1" ...
 $ marquage              : int [1:4460] 46 75 97 17 96 94 8 62 42 10 ...
 $ ID_ind                : chr [1:4460] "VC.Q1.46" "VC.Q1.75" "VC.Q1.97" "VC.Q1.17" ...
 $ observateur           : chr [1:4460] "Damien NICOLAS" "Damien NICOLAS" "Damien NICOLAS" "Damien NICOLAS" ...
 $ adequation            : int [1:4460] 1 1 1 1 1 1 1 1 1 0 ...
 $ phenologie            : chr [1:4460] "fleur" "non_fleuri" "non_fleuri" "non_fleuri" ...
 $ presence              : int [1:4460] 1 1 1 1 1 1 1 1 1 1 ...
 $ quadrat               : int [1:4460] 1 1 1 1 5 5 5 5 5 5 ...
 $ phenologie_verif      : chr [1:4460] "fleur" "non_fleuri" "non_fleuri" "non_fleuri" ...
 $ taille                : chr [1:4460] "34" "26" "27" "20" ...
 $ adequation_reel       : num [1:4460] 1 1 1 1 1 1 1 1 1 0 ...
 $ comparaison_adequation: num [1:4460] 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Pour le moment j'ai un tableau avec tous les individus observés mais je n'ai pas l'info sur individus non observés par observateurs</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="co">#il me faut à chaque fois le nb de quadrats observés par observateurs pour calculer le nombre d'observateurs par quadrat</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>verification_obs_quadrat <span class="ot">&lt;-</span> verification <span class="sc">%&gt;%</span> </span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id_quadrat_fin =</span> <span class="fu">paste</span>(ID_quadrat, session, <span class="at">sep =</span> <span class="st">"."</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id_quadrat_fin, observateur) <span class="sc">%&gt;%</span> </span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Ajouter à tableau détection id_quadrat_fin</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>tab_detection <span class="ot">&lt;-</span> tab_detection <span class="sc">%&gt;%</span> </span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id_quadrat_fin =</span> <span class="fu">paste</span>(ID_quadrat, session, <span class="at">sep =</span> <span class="st">"."</span>))</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Vérifier que pas de NA crées</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>tab_detection[<span class="fu">is.na</span>(tab_detection<span class="sc">$</span>id_quadrat_fin), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 18
# ℹ 18 variables: id_ind_fin &lt;chr&gt;, session &lt;dbl&gt;, site &lt;chr&gt;, date &lt;chr&gt;,
#   numero_quadrat &lt;int&gt;, ID_quadrat &lt;chr&gt;, marquage &lt;int&gt;, ID_ind &lt;chr&gt;,
#   observateur &lt;chr&gt;, adequation &lt;int&gt;, phenologie &lt;chr&gt;, presence &lt;int&gt;,
#   quadrat &lt;int&gt;, phenologie_verif &lt;chr&gt;, taille &lt;chr&gt;, adequation_reel &lt;dbl&gt;,
#   comparaison_adequation &lt;dbl&gt;, id_quadrat_fin &lt;chr&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculer le nombre d'individus par quadrat</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>nb_indiv_quadrat <span class="ot">&lt;-</span> data_original_obs <span class="sc">%&gt;%</span> </span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">id_quadrat_fin =</span> <span class="fu">paste</span>(ID_quadrat, session, <span class="at">sep =</span> <span class="st">"."</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id_quadrat_fin) <span class="sc">%&gt;%</span> </span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">nb_individus =</span> <span class="fu">n_distinct</span>(ID_ind),</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Maintenant je compare ce nombre au nombre observé par mes observateurs</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>difference_ind <span class="ot">&lt;-</span> verification_obs_quadrat <span class="sc">%&gt;%</span> </span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(nb_indiv_quadrat, <span class="at">by =</span> <span class="st">"id_quadrat_fin"</span>)</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Taux de detection par observateur</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>difference_ind <span class="ot">&lt;-</span> difference_ind <span class="sc">%&gt;%</span> </span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">detection =</span> n<span class="sc">/</span>nb_individus)</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a><span class="co">#sortir les identifiants de tous les individus possibles</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>individus_par_quadrat <span class="ot">&lt;-</span> tab_detection <span class="sc">%&gt;%</span></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(id_quadrat_fin, ID_ind)</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a><span class="co">#combinaisons de tous les individus possibles avec les observateurs</span></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>grille_complete <span class="ot">&lt;-</span> difference_ind <span class="sc">%&gt;%</span></span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(id_quadrat_fin, observateur) <span class="sc">%&gt;%</span></span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(individus_par_quadrat, <span class="at">by =</span> <span class="st">"id_quadrat_fin"</span>, <span class="at">relationship =</span> <span class="st">"many-to-many"</span>)</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a><span class="co">#ajouter les informations de detection dans ma grille complete</span></span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>tab_complet <span class="ot">&lt;-</span> grille_complete <span class="sc">%&gt;%</span></span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>    tab_detection <span class="sc">%&gt;%</span></span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">detection =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(id_quadrat_fin, observateur, ID_ind, detection),</span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"id_quadrat_fin"</span>, <span class="st">"observateur"</span>, <span class="st">"ID_ind"</span>)</span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">detection =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(detection), <span class="dv">0</span>, detection)</span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a><span class="co">#Vérifier que ça a marché en comparant le nombre de détections calculées vs le nombre de détection par quadrat</span></span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a>tab_complet <span class="sc">%&gt;%</span></span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id_quadrat_fin, observateur) <span class="sc">%&gt;%</span></span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_detectes =</span> <span class="fu">sum</span>(detection),</span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb64-47"><a href="#cb64-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(difference_ind, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"id_quadrat_fin"</span>, <span class="st">"observateur"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb64-48"><a href="#cb64-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_detectes <span class="sc">!=</span> n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 6
# ℹ 6 variables: id_quadrat_fin &lt;chr&gt;, observateur &lt;chr&gt;, n_detectes &lt;dbl&gt;,
#   n &lt;int&gt;, nb_individus &lt;int&gt;, detection &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co">#récuperer les informations biologiques par individus</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>infos_individus <span class="ot">&lt;-</span> tab_detection <span class="sc">%&gt;%</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    ID_ind,</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>    id_quadrat_fin,</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>    phenologie_verif,</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>    site,</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>    quadrat,</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>    session,</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>    taille</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Vérifier que j'ai bien une info par individu</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>infos_individus <span class="sc">%&gt;%</span></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(ID_ind, id_quadrat_fin) <span class="sc">%&gt;%</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 3
# ℹ 3 variables: ID_ind &lt;chr&gt;, id_quadrat_fin &lt;chr&gt;, n &lt;int&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Ajouter ces informations à mon tableau de détection</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>tab_complet <span class="ot">&lt;-</span> tab_complet <span class="sc">%&gt;%</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    infos_individus,</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ID_ind"</span>, <span class="st">"id_quadrat_fin"</span>)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Extraire la partie quadrat de tab_complet (tout avant le dernier point)</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>tab_complet <span class="ot">&lt;-</span> tab_complet <span class="sc">%&gt;%</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">ID_Quadrat_clean =</span> <span class="fu">str_replace</span>(id_quadrat_fin, <span class="st">"</span><span class="sc">\\</span><span class="st">.[0-9]+$"</span>, <span class="st">""</span>)</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Nettoyer recouvrement pour correspondre au format de tab_complet</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>recouvrement_clean <span class="ot">&lt;-</span> recouvrement <span class="sc">%&gt;%</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">ID_Quadrat_clean =</span> <span class="fu">str_replace_all</span>(ID_Quadrat, <span class="st">"_"</span>, <span class="st">"."</span>)</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(ID_Quadrat_clean, <span class="fu">starts_with</span>(<span class="st">"S_"</span>))</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Faire le left_join pour ajouter les colonnes S_ au tableau complet</span></span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>tab_complet <span class="ot">&lt;-</span> tab_complet <span class="sc">%&gt;%</span></span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(recouvrement_clean, <span class="at">by =</span> <span class="st">"ID_Quadrat_clean"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-2" class="level1">
<h1>——————————-</h1>
</section>
<section id="i_-analyses-préliminaires" class="level1">
<h1>I_ Analyses préliminaires</h1>
<section id="i_i-relation-taille-et-phénologie" class="level2">
<h2 class="anchored" data-anchor-id="i_i-relation-taille-et-phénologie">I_i Relation taille et phénologie</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>data_long <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  data_original <span class="sc">%&gt;%</span> <span class="fu">transmute</span>(<span class="at">pheno =</span> phenoS1, <span class="at">taille =</span> tailleS1),</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  data_original <span class="sc">%&gt;%</span> <span class="fu">transmute</span>(<span class="at">pheno =</span> phenoS2, <span class="at">taille =</span> tailleS2),</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  data_original <span class="sc">%&gt;%</span> <span class="fu">transmute</span>(<span class="at">pheno =</span> phenoS3, <span class="at">taille =</span> tailleS3)</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>data_long <span class="ot">&lt;-</span> data_long <span class="sc">%&gt;%</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">taille =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">","</span>, <span class="st">"."</span>, taille))</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(taille), <span class="sc">!</span><span class="fu">is.na</span>(pheno))</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>data_long<span class="sc">$</span>pheno <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>  data_long<span class="sc">$</span>pheno,</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"j"</span>, <span class="st">"nf"</span>, <span class="st">"f"</span>, <span class="st">"F"</span>, <span class="st">"ff"</span>)</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data_long, <span class="fu">aes</span>(<span class="at">x =</span> pheno, <span class="at">y =</span> taille))<span class="sc">+</span></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Stade phénologique"</span>, <span class="at">y =</span> <span class="st">"Taille"</span>, <span class="at">title =</span> <span class="st">"Taille selon le stade phénologique (sessions confondues)"</span>)<span class="sc">+</span></span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Rédaction_V2_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="i_ii-relation-recouvrement-végétal-et-site" class="level2">
<h2 class="anchored" data-anchor-id="i_ii-relation-recouvrement-végétal-et-site">I_ii Relation recouvrement végétal et site</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyse Factorielle Discriminante (AFD)</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. LDA sur les données originales</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>afd_recouvrement <span class="ot">&lt;-</span> <span class="fu">lda</span>(</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>  Site <span class="sc">~</span> S_muscinale <span class="sc">+</span> S_herbacee <span class="sc">+</span> S_arbustive_basse <span class="sc">+</span> S_arbustive_haute <span class="sc">+</span> S_arborescente,</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> recouvrement</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Centrage et normalisation des variables</span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>newdata <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">scale</span>(recouvrement[, <span class="dv">4</span><span class="sc">:</span><span class="dv">8</span>]))</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a><span class="co"># On ajoute la variable de groupe (Site) pour l'analyse</span></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>newdata<span class="sc">$</span>Site <span class="ot">&lt;-</span> recouvrement<span class="sc">$</span>Site</span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. LDA sur les données centrées-réduites</span></span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>afd2 <span class="ot">&lt;-</span> <span class="fu">lda</span>(</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>  Site <span class="sc">~</span> S_muscinale <span class="sc">+</span> S_herbacee <span class="sc">+</span> S_arbustive_basse <span class="sc">+</span> S_arbustive_haute <span class="sc">+</span> S_arborescente,</span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> newdata</span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. MANOVA pour tester les différences entre groupes</span></span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a>manova_res <span class="ot">&lt;-</span> <span class="fu">manova</span>(<span class="fu">as.matrix</span>(recouvrement[, <span class="dv">4</span><span class="sc">:</span><span class="dv">8</span>]) <span class="sc">~</span> recouvrement<span class="sc">$</span>Site)</span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-34"><a href="#cb70-34" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb70-35"><a href="#cb70-35" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Prédiction avec LDA</span></span>
<span id="cb70-36"><a href="#cb70-36" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb70-37"><a href="#cb70-37" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(afd2)</span>
<span id="cb70-38"><a href="#cb70-38" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">Site =</span> recouvrement<span class="sc">$</span>Site, <span class="at">Predicted =</span> pred<span class="sc">$</span>class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   Predicted
Site                Combe Michaut Tete cendree haut Val Clavin Vigne au Renard
  Combe Michaut                13                 1          0               0
  Tete cendree haut             1                 8          1               1
  Val Clavin                    1                 1          3               1
  Vigne au Renard               0                 1          1              10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Validation croisée (jackknife)</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>afd_cv <span class="ot">&lt;-</span> <span class="fu">lda</span>(</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  Site <span class="sc">~</span> S_muscinale <span class="sc">+</span> S_herbacee <span class="sc">+</span> S_arbustive_basse <span class="sc">+</span> S_arbustive_haute <span class="sc">+</span> S_arborescente,</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> newdata,</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">CV =</span> <span class="cn">TRUE</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">Site =</span> newdata<span class="sc">$</span>Site, <span class="at">Predicted =</span> afd_cv<span class="sc">$</span>class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   Predicted
Site                Combe Michaut Tete cendree haut Val Clavin Vigne au Renard
  Combe Michaut                13                 1          0               0
  Tete cendree haut             1                 5          2               3
  Val Clavin                    2                 0          3               1
  Vigne au Renard               1                 2          0               9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. AFD basée sur l'ACP centrée-réduite</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>pca_res <span class="ot">&lt;-</span> <span class="fu">dudi.pca</span>(recouvrement[, <span class="dv">4</span><span class="sc">:</span><span class="dv">8</span>], <span class="at">scannf =</span> <span class="cn">FALSE</span>, <span class="at">nf =</span> <span class="dv">3</span>)</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>afd3 <span class="ot">&lt;-</span> <span class="fu">discrimin</span>(pca_res, <span class="fu">factor</span>(recouvrement<span class="sc">$</span>Site), <span class="at">scannf =</span> <span class="cn">FALSE</span>, <span class="at">nf =</span> <span class="dv">3</span>) <span class="do">## dans le nombre d'axe, indiquer la valeur adéquate dans pca_res$nf</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Exploration des valeurs propres et des coefficients standardisés</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>afd3<span class="sc">$</span>eig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7690138 0.2342249 0.1999053</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(afd3<span class="sc">$</span>eig <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> afd3<span class="sc">$</span>eig))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6593279 0.4356316 0.4081678</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Projection des variables sur les fonctions discriminantes</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Créer une nouvelle fenêtre graphique (ou plot)</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="fu">s.arrow</span>(afd3<span class="sc">$</span>fa)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Rédaction_V2_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Projection des individus selon leur groupe</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">s.class</span>(afd3<span class="sc">$</span>li, <span class="fu">factor</span>(recouvrement<span class="sc">$</span>Site))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Rédaction_V2_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Regarder contribution relative des variables aux axes</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>afd3<span class="sc">$</span>fa</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                         DS1        DS2        DS3
S_muscinale       -0.6106914  0.2528266 -0.1892449
S_herbacee         0.2079152  0.0183648 -1.5069322
S_arbustive_basse -0.1297242  1.0715477  0.4281626
S_arbustive_haute -0.3887358 -0.0152122  0.2039989
S_arborescente    -0.3729205  0.3098324 -1.1191811</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co">#A priori strate muscinale et arbustive basse sont les plus importantes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="section-3" class="level1">
<h1>——————————-</h1>
</section>
<section id="ii_-analyse-de-la-variation-dans-le-temps" class="level1">
<h1>II_ Analyse de la variation dans le temps</h1>
<section id="ii_i-effet-de-la-session" class="level2">
<h2 class="anchored" data-anchor-id="ii_i-effet-de-la-session">II_i Effet de la session</h2>
<section id="effet-de-la-session-sur-la-taille" class="level3">
<h3 class="anchored" data-anchor-id="effet-de-la-session-sur-la-taille">Effet de la session sur la taille</h3>
<p>Taille ~ session</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer les données en format long</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>taille_long <span class="ot">&lt;-</span> data_original <span class="sc">%&gt;%</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(tailleS1, tailleS2, tailleS3) <span class="sc">%&gt;%</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"session"</span>,</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"taille"</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># remplacer les "," par "." et convertir en numérique</span></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">taille =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">","</span>, <span class="st">"."</span>, taille)),</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># renommer les sessions</span></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">session =</span> dplyr<span class="sc">::</span><span class="fu">recode</span>(session, <span class="st">"tailleS1"</span><span class="ot">=</span><span class="st">"S1"</span>, <span class="st">"tailleS2"</span><span class="ot">=</span><span class="st">"S2"</span>, <span class="st">"tailleS3"</span><span class="ot">=</span><span class="st">"S3"</span>)</span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcul de la moyenne, écart-type et IC 95%</span></span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>taille_stats <span class="ot">&lt;-</span> taille_long <span class="sc">%&gt;%</span></span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(session) <span class="sc">%&gt;%</span></span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_taille =</span> <span class="fu">mean</span>(taille, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_taille =</span> <span class="fu">sd</span>(taille, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(taille)),</span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb83-26"><a href="#cb83-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> sd_taille <span class="sc">/</span> <span class="fu">sqrt</span>(n),</span>
<span id="cb83-27"><a href="#cb83-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci_lower =</span> mean_taille <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se,</span>
<span id="cb83-28"><a href="#cb83-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci_upper =</span> mean_taille <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se</span>
<span id="cb83-29"><a href="#cb83-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb83-30"><a href="#cb83-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-31"><a href="#cb83-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogramme avec IC 95%</span></span>
<span id="cb83-32"><a href="#cb83-32" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(taille_stats, <span class="fu">aes</span>(<span class="at">x =</span> session, <span class="at">y =</span> mean_taille, <span class="at">fill =</span> session)) <span class="sc">+</span></span>
<span id="cb83-33"><a href="#cb83-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">width =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb83-34"><a href="#cb83-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ci_lower, <span class="at">ymax =</span> ci_upper), <span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb83-35"><a href="#cb83-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"S1"</span><span class="ot">=</span><span class="st">"#FF9999"</span>, <span class="st">"S2"</span><span class="ot">=</span><span class="st">"#FF4D4D"</span>, <span class="st">"S3"</span><span class="ot">=</span><span class="st">"#CC0000"</span>)) <span class="sc">+</span></span>
<span id="cb83-36"><a href="#cb83-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb83-37"><a href="#cb83-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Taille moyenne par session"</span>,</span>
<span id="cb83-38"><a href="#cb83-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Session"</span>,</span>
<span id="cb83-39"><a href="#cb83-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Taille moyenne"</span>,</span>
<span id="cb83-40"><a href="#cb83-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Session"</span></span>
<span id="cb83-41"><a href="#cb83-41" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb83-42"><a href="#cb83-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Rédaction_V2_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="effet-de-la-session-sur-la-phénologie" class="level3">
<h3 class="anchored" data-anchor-id="effet-de-la-session-sur-la-phénologie">Effet de la session sur la phénologie</h3>
<p>phénologie ~ session</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer les données en format long : session = S1, S2, S3</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>pheno_long <span class="ot">&lt;-</span> data_original <span class="sc">%&gt;%</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(phenoS1, phenoS2, phenoS3) <span class="sc">%&gt;%</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"session"</span>,</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"pheno"</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remplacer NA par un label pour garder comme modalité</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">pheno =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(pheno), <span class="st">"NA"</span>, <span class="fu">as.character</span>(pheno))) <span class="sc">%&gt;%</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Renommer les sessions plus simplement</span></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">session =</span> dplyr<span class="sc">::</span><span class="fu">recode</span>(session,</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"phenoS1"</span> <span class="ot">=</span> <span class="st">"S1"</span>,</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"phenoS2"</span> <span class="ot">=</span> <span class="st">"S2"</span>,</span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"phenoS3"</span> <span class="ot">=</span> <span class="st">"S3"</span>))</span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcul des effectifs par session et type phénologique</span></span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>pheno_stats <span class="ot">&lt;-</span> pheno_long <span class="sc">%&gt;%</span></span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(session, pheno) <span class="sc">%&gt;%</span></span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># IC 95% approximatif (Poisson)</span></span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> <span class="fu">sqrt</span>(n),</span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci_lower =</span> <span class="fu">pmax</span>(n <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se, <span class="dv">0</span>),</span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci_upper =</span> n <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se</span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-31"><a href="#cb84-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Définir l'ordre des phénos</span></span>
<span id="cb84-32"><a href="#cb84-32" aria-hidden="true" tabindex="-1"></a>pheno_stats<span class="sc">$</span>pheno <span class="ot">&lt;-</span> <span class="fu">factor</span>(pheno_stats<span class="sc">$</span>pheno, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"j"</span>, <span class="st">"nf"</span>, <span class="st">"f"</span>, <span class="st">"ff"</span>, <span class="st">"F"</span>, <span class="st">"NA"</span>))</span>
<span id="cb84-33"><a href="#cb84-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-34"><a href="#cb84-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Graphique avec barres côte à côte et IC 95%</span></span>
<span id="cb84-35"><a href="#cb84-35" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pheno_stats, <span class="fu">aes</span>(<span class="at">x =</span> session, <span class="at">y =</span> n, <span class="at">fill =</span> pheno)) <span class="sc">+</span></span>
<span id="cb84-36"><a href="#cb84-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.8</span>), <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb84-37"><a href="#cb84-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ci_lower, <span class="at">ymax =</span> ci_upper),</span>
<span id="cb84-38"><a href="#cb84-38" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.8</span>), <span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb84-39"><a href="#cb84-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb84-40"><a href="#cb84-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">"j"</span>  <span class="ot">=</span> <span class="st">"#FF9999"</span>,</span>
<span id="cb84-41"><a href="#cb84-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nf"</span> <span class="ot">=</span> <span class="st">"#FF4D4D"</span>,</span>
<span id="cb84-42"><a href="#cb84-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">"f"</span>  <span class="ot">=</span> <span class="st">"#CC0000"</span>,</span>
<span id="cb84-43"><a href="#cb84-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ff"</span> <span class="ot">=</span> <span class="st">"#990000"</span>,</span>
<span id="cb84-44"><a href="#cb84-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">"F"</span>  <span class="ot">=</span> <span class="st">"#660000"</span>,</span>
<span id="cb84-45"><a href="#cb84-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">"NA"</span> <span class="ot">=</span> <span class="st">"#000000"</span>  <span class="co"># noir pur pour NA</span></span>
<span id="cb84-46"><a href="#cb84-46" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb84-47"><a href="#cb84-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb84-48"><a href="#cb84-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Effet de la session (S1, S2, S3) sur la phénologie"</span>,</span>
<span id="cb84-49"><a href="#cb84-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Session"</span>,</span>
<span id="cb84-50"><a href="#cb84-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Nombre d'individus"</span>,</span>
<span id="cb84-51"><a href="#cb84-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Type phénologique"</span></span>
<span id="cb84-52"><a href="#cb84-52" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb84-53"><a href="#cb84-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb84-54"><a href="#cb84-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Rédaction_V2_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="section-4" class="level1">
<h1>——————————-</h1>
</section>
<section id="iii_-analyse-de-la-variation-dans-lespace" class="level1">
<h1>III_ Analyse de la variation dans l’espace</h1>
</section>
<section id="section-5" class="level1">
<h1>——————–</h1>
<section id="iii_i-effet-du-site" class="level2">
<h2 class="anchored" data-anchor-id="iii_i-effet-du-site">III_i Effet du site</h2>
<section id="effet-du-site-sur-la-taille" class="level3">
<h3 class="anchored" data-anchor-id="effet-du-site-sur-la-taille">Effet du site sur la taille</h3>
<p>Taille ~ site</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer les données en format long pour toutes les tailles</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>taille_long <span class="ot">&lt;-</span> data_original <span class="sc">%&gt;%</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(site, tailleS1, tailleS2, tailleS3) <span class="sc">%&gt;%</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(tailleS1, tailleS2, tailleS3),</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"session"</span>,</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"taille"</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># remplacer les "," par "." et convertir en numérique</span></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">taille =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">","</span>, <span class="st">"."</span>, taille))</span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcul de la taille moyenne par site</span></span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>taille_stats <span class="ot">&lt;-</span> taille_long <span class="sc">%&gt;%</span></span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site) <span class="sc">%&gt;%</span></span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_taille =</span> <span class="fu">mean</span>(taille, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_taille =</span> <span class="fu">sd</span>(taille, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(taille)),</span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb85-22"><a href="#cb85-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb85-23"><a href="#cb85-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb85-24"><a href="#cb85-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> sd_taille <span class="sc">/</span> <span class="fu">sqrt</span>(n),</span>
<span id="cb85-25"><a href="#cb85-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci_lower =</span> mean_taille <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se,</span>
<span id="cb85-26"><a href="#cb85-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci_upper =</span> mean_taille <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se</span>
<span id="cb85-27"><a href="#cb85-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb85-28"><a href="#cb85-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-29"><a href="#cb85-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogramme avec IC 95%</span></span>
<span id="cb85-30"><a href="#cb85-30" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(taille_stats, <span class="fu">aes</span>(<span class="at">x =</span> site, <span class="at">y =</span> mean_taille)) <span class="sc">+</span></span>
<span id="cb85-31"><a href="#cb85-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb85-32"><a href="#cb85-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ci_lower, <span class="at">ymax =</span> ci_upper), <span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb85-33"><a href="#cb85-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb85-34"><a href="#cb85-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Taille moyenne par site"</span>,</span>
<span id="cb85-35"><a href="#cb85-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Site"</span>,</span>
<span id="cb85-36"><a href="#cb85-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Taille moyenne"</span>,</span>
<span id="cb85-37"><a href="#cb85-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Site"</span></span>
<span id="cb85-38"><a href="#cb85-38" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb85-39"><a href="#cb85-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb85-40"><a href="#cb85-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Ignoring unknown labels:
• fill : "Site"</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Rédaction_V2_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="effet-du-site-sur-la-taille-selon-la-session" class="level3">
<h3 class="anchored" data-anchor-id="effet-du-site-sur-la-taille-selon-la-session">Effet du site sur la taille selon la session</h3>
<p>Taille ~ site + session</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assurer que les colonnes de taille sont numériques</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>data_original <span class="ot">&lt;-</span> data_original <span class="sc">%&gt;%</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">tailleS1 =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">","</span>, <span class="st">"."</span>, tailleS1)),</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">tailleS2 =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">","</span>, <span class="st">"."</span>, tailleS2)),</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">tailleS3 =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">","</span>, <span class="st">"."</span>, tailleS3))</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcul des statistiques pour chaque taille</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>stats_long <span class="ot">&lt;-</span> data_original <span class="sc">%&gt;%</span></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(tailleS1, tailleS2, tailleS3),</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"taille_type"</span>,</span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"taille"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site, taille_type) <span class="sc">%&gt;%</span></span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean =</span> <span class="fu">mean</span>(taille, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd =</span> <span class="fu">sd</span>(taille, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(taille))</span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> sd <span class="sc">/</span> <span class="fu">sqrt</span>(n),</span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci95 =</span> se <span class="sc">*</span> <span class="fu">qt</span>(<span class="fl">0.975</span>, <span class="at">df =</span> n <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'site'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Définir des couleurs rouges avec différentes opacités</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>red_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"tailleS1"</span> <span class="ot">=</span> <span class="st">"#FF6666"</span>,  <span class="co"># clair</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>                <span class="st">"tailleS2"</span> <span class="ot">=</span> <span class="st">"#FF3333"</span>,  <span class="co"># moyen</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>                <span class="st">"tailleS3"</span> <span class="ot">=</span> <span class="st">"#CC0000"</span>)  <span class="co"># foncé</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Graphique avec les trois tailles côte à côte par site</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(stats_long, <span class="fu">aes</span>(<span class="at">x =</span> site, <span class="at">y =</span> mean, <span class="at">fill =</span> taille_type)) <span class="sc">+</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.8</span>), <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> mean <span class="sc">-</span> ci95, <span class="at">ymax =</span> mean <span class="sc">+</span> ci95),</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.8</span>), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> red_colors) <span class="sc">+</span></span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Taille moyenne par site avec IC 95%"</span>,</span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Taille moyenne"</span>,</span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Site"</span>,</span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Type de taille"</span></span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Rédaction_V2_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="effet-du-site-sur-la-phénologie" class="level3">
<h3 class="anchored" data-anchor-id="effet-du-site-sur-la-phénologie">Effet du site sur la phénologie</h3>
<p>phénologie ~ site</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer les phénos en format long en gardant les NA</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>pheno_long <span class="ot">&lt;-</span> data_original <span class="sc">%&gt;%</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(site, phenoS1, phenoS2, phenoS3) <span class="sc">%&gt;%</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(phenoS1, phenoS2, phenoS3),</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"pheno_type"</span>,</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"pheno"</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remplacer NA par un label pour garder comme modalité</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pheno =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(pheno), <span class="st">"NA"</span>, <span class="fu">as.character</span>(pheno)))</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcul des effectifs par site et type phénologique</span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>pheno_stats <span class="ot">&lt;-</span> pheno_long <span class="sc">%&gt;%</span></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site, pheno) <span class="sc">%&gt;%</span></span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(site, pheno, <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">n =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span>  <span class="co"># inclure les combinaisons manquantes</span></span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># IC 95% approximatif pour comptages (Poisson)</span></span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> <span class="fu">sqrt</span>(n),</span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci_lower =</span> <span class="fu">pmax</span>(n <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se, <span class="dv">0</span>),</span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci_upper =</span> n <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se</span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Définir l'ordre des phénos</span></span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a>pheno_stats<span class="sc">$</span>pheno <span class="ot">&lt;-</span> <span class="fu">factor</span>(pheno_stats<span class="sc">$</span>pheno, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"j"</span>, <span class="st">"nf"</span>, <span class="st">"f"</span>, <span class="st">"ff"</span>, <span class="st">"F"</span>, <span class="st">"NA"</span>))</span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-27"><a href="#cb90-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Graphique avec barres côte à côte et IC 95%</span></span>
<span id="cb90-28"><a href="#cb90-28" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pheno_stats, <span class="fu">aes</span>(<span class="at">x =</span> site, <span class="at">y =</span> n, <span class="at">fill =</span> pheno)) <span class="sc">+</span></span>
<span id="cb90-29"><a href="#cb90-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.8</span>), <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb90-30"><a href="#cb90-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ci_lower, <span class="at">ymax =</span> ci_upper),</span>
<span id="cb90-31"><a href="#cb90-31" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.8</span>), <span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb90-32"><a href="#cb90-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb90-33"><a href="#cb90-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"j"</span>  <span class="ot">=</span> <span class="st">"#FF9999"</span>,</span>
<span id="cb90-34"><a href="#cb90-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nf"</span> <span class="ot">=</span> <span class="st">"#FF4D4D"</span>,</span>
<span id="cb90-35"><a href="#cb90-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">"f"</span>  <span class="ot">=</span> <span class="st">"#CC0000"</span>,</span>
<span id="cb90-36"><a href="#cb90-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ff"</span> <span class="ot">=</span> <span class="st">"#990000"</span>,</span>
<span id="cb90-37"><a href="#cb90-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">"F"</span>  <span class="ot">=</span> <span class="st">"#660000"</span>,</span>
<span id="cb90-38"><a href="#cb90-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">"NA"</span> <span class="ot">=</span> <span class="st">"#000000"</span>  <span class="co"># noir pur pour NA</span></span>
<span id="cb90-39"><a href="#cb90-39" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb90-40"><a href="#cb90-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb90-41"><a href="#cb90-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Effet du site sur la phénologie"</span>,</span>
<span id="cb90-42"><a href="#cb90-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Site"</span>,</span>
<span id="cb90-43"><a href="#cb90-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Nombre d'individus"</span>,</span>
<span id="cb90-44"><a href="#cb90-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Type phénologique"</span></span>
<span id="cb90-45"><a href="#cb90-45" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb90-46"><a href="#cb90-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb90-47"><a href="#cb90-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Rédaction_V2_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="section-6" class="level1">
<h1>——————–</h1>
<section id="iii_ii-effet-de-la-strate" class="level2">
<h2 class="anchored" data-anchor-id="iii_ii-effet-de-la-strate">III_ii Effet de la strate</h2>
<section id="effet-de-la-strate-sur-la-taille" class="level3">
<h3 class="anchored" data-anchor-id="effet-de-la-strate-sur-la-taille">Effet de la strate sur la taille</h3>
<p>Taille ~ strate</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Joindre les données par ID_Quadrat</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>data_joined <span class="ot">&lt;-</span> data_original <span class="sc">%&gt;%</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(recouvrement, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ID_quadrat"</span> <span class="ot">=</span> <span class="st">"ID_Quadrat"</span>))</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcul de la taille moyenne par individu</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>data_joined <span class="ot">&lt;-</span> data_joined <span class="sc">%&gt;%</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">tailleS1 =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">","</span>, <span class="st">"."</span>, tailleS1)),</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">tailleS2 =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">","</span>, <span class="st">"."</span>, tailleS2)),</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">tailleS3 =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">","</span>, <span class="st">"."</span>, tailleS3)),</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">taille_moyenne =</span> <span class="fu">rowMeans</span>(dplyr<span class="sc">::</span><span class="fu">select</span>(., tailleS1, tailleS2, tailleS3), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer les strates en format long pour facettes</span></span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>recouvrement_long <span class="ot">&lt;-</span> data_joined <span class="sc">%&gt;%</span></span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(S_muscinale, S_herbacee, S_arbustive_basse, S_arbustive_haute, S_arborescente),</span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"strate"</span>,</span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"recouvrement"</span></span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Formule pour afficher R² et p-value</span></span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a>eqn <span class="ot">&lt;-</span> ggpmisc<span class="sc">::</span><span class="fu">stat_poly_eq</span>(</span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste</span>(..eq.label.., ..rr.label.., ..p.value.label.., <span class="at">sep =</span> <span class="st">"~~~"</span>)),</span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> y <span class="sc">~</span> x,</span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">parse =</span> <span class="cn">TRUE</span>,</span>
<span id="cb91-27"><a href="#cb91-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">label.x.npc =</span> <span class="st">"right"</span>,</span>
<span id="cb91-28"><a href="#cb91-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">label.y.npc =</span> <span class="fl">0.1</span>,</span>
<span id="cb91-29"><a href="#cb91-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> <span class="dv">3</span></span>
<span id="cb91-30"><a href="#cb91-30" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in ggpmisc::stat_poly_eq(aes(label = paste(..eq.label.., ..rr.label..,
: Ignoring unknown parameters: `label.x.npc` and `label.y.npc`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Graphique par strate avec couleurs modifiées</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(recouvrement_long, <span class="fu">aes</span>(<span class="at">x =</span> recouvrement, <span class="at">y =</span> taille_moyenne)) <span class="sc">+</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span>  <span class="co"># points noirs</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"#CC0000"</span>, <span class="at">fill =</span> <span class="st">"#FF9999"</span>) <span class="sc">+</span>  <span class="co"># ligne rouge foncé, IC rouge clair</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>  eqn <span class="sc">+</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> strate, <span class="at">scales =</span> <span class="st">"free_x"</span>) <span class="sc">+</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Taille moyenne en fonction du recouvrement végétal par strate"</span>,</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Recouvrement (%)"</span>,</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Taille moyenne"</span></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The dot-dot notation (`..eq.label..`) was deprecated in ggplot2 3.4.0.
ℹ Please use `after_stat(eq.label)` instead.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Rédaction_V2_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="effet-de-la-strate-sur-la-phénologie" class="level3">
<h3 class="anchored" data-anchor-id="effet-de-la-strate-sur-la-phénologie">Effet de la strate sur la phénologie</h3>
<p>phénologie ~ strate</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Phénologie en format long</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>pheno_long <span class="ot">&lt;-</span> data_original <span class="sc">%&gt;%</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(ID_quadrat, phenoS1, phenoS2, phenoS3) <span class="sc">%&gt;%</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"pheno"</span>),</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"session"</span>,</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"pheno"</span></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pheno =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(pheno), <span class="st">"NA"</span>, pheno))</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Tableau de contingence (fréquences)</span></span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>pheno_tab <span class="ot">&lt;-</span> pheno_long <span class="sc">%&gt;%</span></span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID_quadrat, pheno) <span class="sc">%&gt;%</span></span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> pheno,</span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> n,</span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_fill =</span> <span class="dv">0</span></span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-21"><a href="#cb96-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Vérification</span></span>
<span id="cb96-22"><a href="#cb96-22" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(pheno_tab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [27 × 7] (S3: tbl_df/tbl/data.frame)
 $ ID_quadrat: chr [1:27] "CM.Q1" "CM.Q11" "CM.Q2" "CM.Q4" ...
 $ NA        : int [1:27] 25 0 0 4 12 0 0 7 3 1 ...
 $ f         : int [1:27] 1 0 0 1 2 2 1 9 0 0 ...
 $ ff        : int [1:27] 7 0 0 1 1 2 1 1 0 0 ...
 $ j         : int [1:27] 43 5 1 16 49 4 6 21 6 7 ...
 $ nf        : int [1:27] 71 13 4 17 85 29 19 56 9 7 ...
 $ F         : int [1:27] 0 0 1 0 1 2 0 5 0 0 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>data_rda <span class="ot">&lt;-</span> pheno_tab <span class="sc">%&gt;%</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(recouvrement, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ID_quadrat"</span> <span class="ot">=</span> <span class="st">"ID_Quadrat"</span>)) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="st">"NA"</span>)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables explicatives (recouvrement)</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> data_rda <span class="sc">%&gt;%</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>    S_muscinale,</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>    S_herbacee,</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>    S_arbustive_basse,</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>    S_arbustive_haute,</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>    S_arborescente</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> data_rda <span class="sc">%&gt;%</span></span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(j, nf, f, ff, F)</span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Hellinger (très recommandé)</span></span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a>Y_hel <span class="ot">&lt;-</span> <span class="fu">decostand</span>(Y, <span class="at">method =</span> <span class="st">"hellinger"</span>)</span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> data_rda <span class="sc">%&gt;%</span></span>
<span id="cb98-21"><a href="#cb98-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb98-22"><a href="#cb98-22" aria-hidden="true" tabindex="-1"></a>    S_muscinale,</span>
<span id="cb98-23"><a href="#cb98-23" aria-hidden="true" tabindex="-1"></a>    S_herbacee,</span>
<span id="cb98-24"><a href="#cb98-24" aria-hidden="true" tabindex="-1"></a>    S_arbustive_basse,</span>
<span id="cb98-25"><a href="#cb98-25" aria-hidden="true" tabindex="-1"></a>    S_arbustive_haute,</span>
<span id="cb98-26"><a href="#cb98-26" aria-hidden="true" tabindex="-1"></a>    S_arborescente</span>
<span id="cb98-27"><a href="#cb98-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb98-28"><a href="#cb98-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-29"><a href="#cb98-29" aria-hidden="true" tabindex="-1"></a>rda_pheno <span class="ot">&lt;-</span> <span class="fu">rda</span>(Y_hel <span class="sc">~</span> ., <span class="at">data =</span> X)</span>
<span id="cb98-30"><a href="#cb98-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-31"><a href="#cb98-31" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rda_pheno, <span class="at">scaling =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Rédaction_V2_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>a_1<span class="ot">&lt;-</span> <span class="fu">anova</span>(rda_pheno)          <span class="co"># effet global du recouvrement</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>a_2<span class="ot">&lt;-</span><span class="fu">anova</span>(rda_pheno, <span class="at">by=</span><span class="st">"term"</span>) <span class="co"># effet de chaque strate</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>a_3<span class="ot">&lt;-</span> <span class="fu">anova</span>(rda_pheno, <span class="at">by=</span><span class="st">"axis"</span>) <span class="co"># axes significatifs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La RDA montre que le recouvrement végétal n’explique pas significativement la variation globale de la phénologie (p = 0.146). Toutefois, le recouvrement herbacé et arbustif bas présentent des effets proches du seuil de significativité (p &lt; 0.1). Les strates hautes (arbustive haute et arborescente) n’influencent pas la phénologie. Ces résultats suggèrent que la phénologie est principalement associée à la structure végétale proche du sol.</p>
</section>
</section>
</section>
<section id="section-7" class="level1">
<h1>——————————-</h1>
</section>
<section id="iv_-niveau-des-observateurs" class="level1">
<h1>IV_ Niveau des observateurs</h1>
<section id="adéquation-et-fiabilité-des-observateurs" class="level2">
<h2 class="anchored" data-anchor-id="adéquation-et-fiabilité-des-observateurs">Adéquation et fiabilité des observateurs</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Taux d’erreur d’adéquation par observateur</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>verification3 <span class="ot">&lt;-</span> verification <span class="sc">%&gt;%</span> </span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(observateur) <span class="sc">%&gt;%</span> </span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(adequation) <span class="sc">%&gt;%</span> </span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> adequation,</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> n,</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_glue =</span> <span class="st">"{ifelse(adequation == 1, 'id_valide', 'id_fausse')}"</span></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_na</span>(<span class="fu">list</span>(</span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_valide =</span> <span class="dv">0</span>,</span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_fausse =</span> <span class="dv">0</span></span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_total =</span> id_valide <span class="sc">+</span> id_fausse,</span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">tx_erreur =</span> id_fausse <span class="sc">/</span> id_total</span>
<span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb100-21"><a href="#cb100-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-22"><a href="#cb100-22" aria-hidden="true" tabindex="-1"></a>verification3 <span class="ot">&lt;-</span> verification3 <span class="sc">%&gt;%</span></span>
<span id="cb100-23"><a href="#cb100-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb100-24"><a href="#cb100-24" aria-hidden="true" tabindex="-1"></a>    experience <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(Observateur, sexe),</span>
<span id="cb100-25"><a href="#cb100-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"observateur"</span> <span class="ot">=</span> <span class="st">"Observateur"</span>)</span>
<span id="cb100-26"><a href="#cb100-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb100-27"><a href="#cb100-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-28"><a href="#cb100-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Vérification des adéquations manquantes</span></span>
<span id="cb100-29"><a href="#cb100-29" aria-hidden="true" tabindex="-1"></a>verification <span class="sc">%&gt;%</span> </span>
<span id="cb100-30"><a href="#cb100-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(adequation))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  session       site       date numero_quadrat ID_quadrat marquage   ID_ind
1       3 Val Clavin 02/07/2024              4      VC.Q4       45 VC.Q4.45
2       3 Val Clavin 02/07/2024              4      VC.Q4       19 VC.Q4.19
        observateur juv non_fleuri fleur fleurs_fanees fruit adequation
1  Aurelien GREAUME   0          0     0             0     1         NA
2 Gabrielle BARRAUT   0          1     0             0     0         NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Score moyen d’auto-évaluation (A à E)</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>experience <span class="ot">&lt;-</span> experience <span class="sc">%&gt;%</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">score_moyen =</span> <span class="fu">rowMeans</span>(<span class="fu">across</span>(A<span class="sc">:</span>E), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">fiabilite =</span> score_moyen <span class="sc">/</span> <span class="dv">10</span>,</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">risque_erreur =</span> <span class="dv">1</span> <span class="sc">-</span> fiabilite</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Variabilité intra-observateur</span></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>experience <span class="ot">&lt;-</span> experience <span class="sc">%&gt;%</span></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ecart_type =</span> <span class="fu">sd</span>(<span class="fu">c_across</span>(A<span class="sc">:</span>E), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Classement par risque d’erreur</span></span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a>experience <span class="ot">&lt;-</span> experience <span class="sc">%&gt;%</span></span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(risque_erreur)) <span class="sc">%&gt;%</span></span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ID.observateur =</span> <span class="fu">factor</span>(ID.observateur, <span class="at">levels =</span> ID.observateur))</span>
<span id="cb102-22"><a href="#cb102-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-23"><a href="#cb102-23" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb102-24"><a href="#cb102-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Fusion auto-évaluation / adéquation réelle</span></span>
<span id="cb102-25"><a href="#cb102-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb102-26"><a href="#cb102-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-27"><a href="#cb102-27" aria-hidden="true" tabindex="-1"></a>experience2 <span class="ot">&lt;-</span> experience <span class="sc">%&gt;%</span> </span>
<span id="cb102-28"><a href="#cb102-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb102-29"><a href="#cb102-29" aria-hidden="true" tabindex="-1"></a>    verification3,</span>
<span id="cb102-30"><a href="#cb102-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">join_by</span>(<span class="st">"Observateur"</span> <span class="sc">==</span> <span class="st">"observateur"</span>)</span>
<span id="cb102-31"><a href="#cb102-31" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb102-32"><a href="#cb102-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-33"><a href="#cb102-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-34"><a href="#cb102-34" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb102-35"><a href="#cb102-35" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Taux de détection réel par observateur</span></span>
<span id="cb102-36"><a href="#cb102-36" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb102-37"><a href="#cb102-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-38"><a href="#cb102-38" aria-hidden="true" tabindex="-1"></a>tx_erreur <span class="ot">&lt;-</span> tab_complet <span class="sc">%&gt;%</span> </span>
<span id="cb102-39"><a href="#cb102-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(observateur) <span class="sc">%&gt;%</span> </span>
<span id="cb102-40"><a href="#cb102-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb102-41"><a href="#cb102-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">nb_ind =</span> <span class="fu">n</span>(),</span>
<span id="cb102-42"><a href="#cb102-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">nb_detect =</span> <span class="fu">sum</span>(detection, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb102-43"><a href="#cb102-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">tx_detect =</span> nb_detect <span class="sc">/</span> nb_ind</span>
<span id="cb102-44"><a href="#cb102-44" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb102-45"><a href="#cb102-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-46"><a href="#cb102-46" aria-hidden="true" tabindex="-1"></a>tx_erreur_fin <span class="ot">&lt;-</span> experience2 <span class="sc">%&gt;%</span> </span>
<span id="cb102-47"><a href="#cb102-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb102-48"><a href="#cb102-48" aria-hidden="true" tabindex="-1"></a>    tx_erreur,</span>
<span id="cb102-49"><a href="#cb102-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">join_by</span>(<span class="st">"Observateur"</span> <span class="sc">==</span> <span class="st">"observateur"</span>)</span>
<span id="cb102-50"><a href="#cb102-50" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb102-51"><a href="#cb102-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-52"><a href="#cb102-52" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb102-53"><a href="#cb102-53" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Graphiques</span></span>
<span id="cb102-54"><a href="#cb102-54" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="erreur-dattribution-phénologique-vs-non-détection" class="level3">
<h3 class="anchored" data-anchor-id="erreur-dattribution-phénologique-vs-non-détection">Erreur d’attribution phénologique vs non-détection</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tx_erreur_fin, <span class="fu">aes</span>(<span class="at">x =</span> tx_erreur, <span class="at">y =</span> <span class="dv">1</span> <span class="sc">-</span> tx_detect)) <span class="sc">+</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> sexe.x, <span class="at">size =</span> id_total),</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.8</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> <span class="cn">TRUE</span>,</span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"pink"</span>,</span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.3</span></span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(</span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> Observateur, <span class="at">color =</span> sexe.x),</span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">max.overlaps =</span> <span class="cn">Inf</span>,</span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">force =</span> <span class="dv">5</span>,</span>
<span id="cb103-18"><a href="#cb103-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">box.padding =</span> <span class="fl">0.6</span>,</span>
<span id="cb103-19"><a href="#cb103-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">point.padding =</span> <span class="fl">0.5</span>,</span>
<span id="cb103-20"><a href="#cb103-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">segment.color =</span> <span class="st">"grey60"</span>,</span>
<span id="cb103-21"><a href="#cb103-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">segment.size =</span> <span class="fl">0.4</span></span>
<span id="cb103-22"><a href="#cb103-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb103-23"><a href="#cb103-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"f"</span> <span class="ot">=</span> <span class="st">"#E41A1C"</span>, <span class="st">"m"</span> <span class="ot">=</span> <span class="st">"#377EB8"</span>)) <span class="sc">+</span></span>
<span id="cb103-24"><a href="#cb103-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb103-25"><a href="#cb103-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb103-26"><a href="#cb103-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relation entre taux d'erreur d'attribution et non-détection"</span>,</span>
<span id="cb103-27"><a href="#cb103-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Taux d'erreur d'attribution de la phénologie"</span>,</span>
<span id="cb103-28"><a href="#cb103-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Taux de non-détection"</span>,</span>
<span id="cb103-29"><a href="#cb103-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Sexe"</span>,</span>
<span id="cb103-30"><a href="#cb103-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="st">"Nombre d'observations"</span></span>
<span id="cb103-31"><a href="#cb103-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb103-32"><a href="#cb103-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb103-33"><a href="#cb103-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb103-34"><a href="#cb103-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb103-35"><a href="#cb103-35" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Rédaction_V2_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="autonotation-vs-erreur-dattribution-phénologique" class="level3">
<h3 class="anchored" data-anchor-id="autonotation-vs-erreur-dattribution-phénologique">Autonotation vs erreur d’attribution phénologique</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tx_erreur_fin, <span class="fu">aes</span>(<span class="at">x =</span> risque_erreur, <span class="at">y =</span> tx_erreur)) <span class="sc">+</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> sexe.x, <span class="at">size =</span> id_total),</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.8</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> <span class="cn">TRUE</span>,</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"pink"</span>,</span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.3</span></span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(</span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> Observateur, <span class="at">color =</span> sexe.x),</span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">max.overlaps =</span> <span class="cn">Inf</span>,</span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">force =</span> <span class="dv">5</span>,</span>
<span id="cb105-18"><a href="#cb105-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">box.padding =</span> <span class="fl">0.6</span>,</span>
<span id="cb105-19"><a href="#cb105-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">point.padding =</span> <span class="fl">0.5</span>,</span>
<span id="cb105-20"><a href="#cb105-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">segment.color =</span> <span class="st">"grey60"</span>,</span>
<span id="cb105-21"><a href="#cb105-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">segment.size =</span> <span class="fl">0.4</span></span>
<span id="cb105-22"><a href="#cb105-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb105-23"><a href="#cb105-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"f"</span> <span class="ot">=</span> <span class="st">"#E41A1C"</span>, <span class="st">"m"</span> <span class="ot">=</span> <span class="st">"#377EB8"</span>)) <span class="sc">+</span></span>
<span id="cb105-24"><a href="#cb105-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb105-25"><a href="#cb105-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb105-26"><a href="#cb105-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relation entre risque d'erreur (auto-évaluation) et erreur d'attribution"</span>,</span>
<span id="cb105-27"><a href="#cb105-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Risque d'erreur basé sur l'auto-évaluation"</span>,</span>
<span id="cb105-28"><a href="#cb105-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Taux d'erreur d'attribution de la phénologie"</span>,</span>
<span id="cb105-29"><a href="#cb105-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Sexe"</span>,</span>
<span id="cb105-30"><a href="#cb105-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="st">"Nombre d'observations"</span></span>
<span id="cb105-31"><a href="#cb105-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb105-32"><a href="#cb105-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb105-33"><a href="#cb105-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb105-34"><a href="#cb105-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb105-35"><a href="#cb105-35" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Rédaction_V2_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="autonotation-vs-non-détection" class="level3">
<h3 class="anchored" data-anchor-id="autonotation-vs-non-détection">Autonotation vs non-détection</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tx_erreur_fin, <span class="fu">aes</span>(<span class="at">x =</span> risque_erreur, <span class="at">y =</span> <span class="dv">1</span> <span class="sc">-</span> tx_detect)) <span class="sc">+</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> sexe.x, <span class="at">size =</span> id_total),</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.8</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> <span class="cn">TRUE</span>,</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"pink"</span>,</span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.3</span></span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(</span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> Observateur, <span class="at">color =</span> sexe.x),</span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">max.overlaps =</span> <span class="cn">Inf</span>,</span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">force =</span> <span class="dv">5</span>,</span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">box.padding =</span> <span class="fl">0.6</span>,</span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">point.padding =</span> <span class="fl">0.5</span>,</span>
<span id="cb107-20"><a href="#cb107-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">segment.color =</span> <span class="st">"grey60"</span>,</span>
<span id="cb107-21"><a href="#cb107-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">segment.size =</span> <span class="fl">0.4</span></span>
<span id="cb107-22"><a href="#cb107-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb107-23"><a href="#cb107-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"f"</span> <span class="ot">=</span> <span class="st">"#E41A1C"</span>, <span class="st">"m"</span> <span class="ot">=</span> <span class="st">"#377EB8"</span>)) <span class="sc">+</span></span>
<span id="cb107-24"><a href="#cb107-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb107-25"><a href="#cb107-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb107-26"><a href="#cb107-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relation entre risque d'erreur (auto-évaluation) et non-détection"</span>,</span>
<span id="cb107-27"><a href="#cb107-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Risque d'erreur basé sur l'auto-évaluation"</span>,</span>
<span id="cb107-28"><a href="#cb107-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Taux de non-détection"</span>,</span>
<span id="cb107-29"><a href="#cb107-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Sexe"</span>,</span>
<span id="cb107-30"><a href="#cb107-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="st">"Nombre d'observations"</span></span>
<span id="cb107-31"><a href="#cb107-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb107-32"><a href="#cb107-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb107-33"><a href="#cb107-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb107-34"><a href="#cb107-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb107-35"><a href="#cb107-35" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Rédaction_V2_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="analyses-complémentaires" class="level3">
<h3 class="anchored" data-anchor-id="analyses-complémentaires">Analyses complémentaires</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualisation des 3 axes en 3D </span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Graphique 3D interactif avec taille fixe</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>  tx_erreur_fin,</span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="sc">~</span>tx_erreur,</span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="sc">~</span>risque_erreur,</span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">z =</span> <span class="sc">~</span> (<span class="dv">1</span> <span class="sc">-</span> tx_detect),</span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"scatter3d"</span>,</span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">mode =</span> <span class="st">"markers+text"</span>,</span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">text =</span> <span class="sc">~</span>Observateur,</span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">textposition =</span> <span class="st">"top center"</span>,</span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">marker =</span> <span class="fu">list</span>(</span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">5</span>,  <span class="co"># taille fixe pour tous les points</span></span>
<span id="cb109-17"><a href="#cb109-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="sc">~</span><span class="fu">ifelse</span>(sexe.x <span class="sc">==</span> <span class="st">"f"</span>, <span class="st">"#E41A1C"</span>, <span class="st">"#377EB8"</span>),</span>
<span id="cb109-18"><a href="#cb109-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">opacity =</span> <span class="fl">0.8</span></span>
<span id="cb109-19"><a href="#cb109-19" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb109-20"><a href="#cb109-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">hovertemplate =</span> <span class="fu">paste</span>(</span>
<span id="cb109-21"><a href="#cb109-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"&lt;b&gt;%{text}&lt;/b&gt;&lt;br&gt;"</span>,</span>
<span id="cb109-22"><a href="#cb109-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Sexe: %{customdata[0]}&lt;br&gt;"</span>,</span>
<span id="cb109-23"><a href="#cb109-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Taux erreur: %{x}&lt;br&gt;"</span>,</span>
<span id="cb109-24"><a href="#cb109-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Risque auto: %{y}&lt;br&gt;"</span>,</span>
<span id="cb109-25"><a href="#cb109-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Non-détection: %{z}&lt;br&gt;"</span>,</span>
<span id="cb109-26"><a href="#cb109-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"&lt;extra&gt;&lt;/extra&gt;"</span></span>
<span id="cb109-27"><a href="#cb109-27" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb109-28"><a href="#cb109-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">customdata =</span> tx_erreur_fin[, <span class="fu">c</span>(<span class="st">"sexe.x"</span>)]</span>
<span id="cb109-29"><a href="#cb109-29" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb109-30"><a href="#cb109-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb109-31"><a href="#cb109-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">scene =</span> <span class="fu">list</span>(</span>
<span id="cb109-32"><a href="#cb109-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Taux d'erreur d'attribution"</span>),</span>
<span id="cb109-33"><a href="#cb109-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Risque d'erreur (auto-évaluation)"</span>),</span>
<span id="cb109-34"><a href="#cb109-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">zaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Taux de non-détection"</span>)</span>
<span id="cb109-35"><a href="#cb109-35" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb109-36"><a href="#cb109-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Graphique 3D interactif des erreurs et non-détection"</span></span>
<span id="cb109-37"><a href="#cb109-37" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-4391ec29fafe7af1ccde" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-4391ec29fafe7af1ccde">{"x":{"visdat":{"24e486c66d7":["function () ","plotlyVisDat"]},"cur_data":"24e486c66d7","attrs":{"24e486c66d7":{"x":{},"y":{},"z":{},"mode":"markers+text","text":{},"textposition":"top center","marker":{"size":5,"color":{},"opacity":0.80000000000000004},"hovertemplate":"<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","customdata":[{"sexe.x":"f"},{"sexe.x":"m"},{"sexe.x":"m"},{"sexe.x":"f"},{"sexe.x":"f"},{"sexe.x":"m"},{"sexe.x":"m"},{"sexe.x":"m"},{"sexe.x":"f"},{"sexe.x":"f"},{"sexe.x":"f"},{"sexe.x":"f"},{"sexe.x":"m"},{"sexe.x":"f"},{"sexe.x":"f"},{"sexe.x":"f"},{"sexe.x":"m"},{"sexe.x":"m"},{"sexe.x":"f"},{"sexe.x":"m"},{"sexe.x":"m"},{"sexe.x":"m"},{"sexe.x":"f"},{"sexe.x":"m"},{"sexe.x":"m"},{"sexe.x":"m"},{"sexe.x":"m"},{"sexe.x":"m"},{"sexe.x":"f"},{"sexe.x":"m"},{"sexe.x":"f"},{"sexe.x":"f"},{"sexe.x":"f"},{"sexe.x":"f"},{"sexe.x":"m"}],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Taux d'erreur d'attribution"},"yaxis":{"title":"Risque d'erreur (auto-évaluation)"},"zaxis":{"title":"Taux de non-détection"}},"title":"Graphique 3D interactif des erreurs et non-détection","hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[0.33727810650887574,0.10429447852760736,0.15873015873015872,0.20634920634920634,0.33561643835616439,0.12,0.10344827586206896,0.39285714285714285,0.5,0.15555555555555556,0.30252100840336132,0.076923076923076927,0.16216216216216217,0.15241635687732341,0.25,0.16083916083916083,0.22727272727272727,0.40243902439024393,0.1417910447761194,0.20430107526881722,0,0.1092436974789916,0.16666666666666666,0.27131782945736432,0.17346938775510204,0.13793103448275862,0.082568807339449546,0.20224719101123595,0.079207920792079209,0.19004524886877827,0.11567164179104478,0.070921985815602842,0.19444444444444445,0.19191919191919191,0.064285714285714279],"y":[0.90000000000000002,0.88,0.88,0.88,0.85999999999999999,0.85999999999999999,0.85999999999999999,0.83999999999999997,0.82000000000000006,0.80000000000000004,0.80000000000000004,0.80000000000000004,0.78000000000000003,0.78000000000000003,0.78000000000000003,0.73999999999999999,0.73999999999999999,0.71999999999999997,0.71999999999999997,0.69999999999999996,0.67999999999999994,0.66000000000000003,0.66000000000000003,0.62,0.59999999999999998,0.5,0.45999999999999996,0.44000000000000006,0.44000000000000006,0.44000000000000006,0.40000000000000002,0.40000000000000002,0.34000000000000008,0.21999999999999997,0.18000000000000005],"z":[0.32270916334661359,0.32921810699588472,0.26744186046511631,0.64406779661016955,0.27722772277227725,0.40476190476190477,0.45283018867924529,0.43624161073825507,0.57692307692307687,0.51086956521739135,0.37037037037037035,0.31578947368421051,0.22916666666666663,0.28835978835978837,0.25853658536585367,0.38626609442060089,0.58095238095238089,0.42657342657342656,0.26775956284153002,0.41509433962264153,0.30769230769230771,0.37696335078534027,0.38666666666666671,0.25433526011560692,0.37579617834394907,0.19444444444444442,0.36627906976744184,0.30649350649350648,0.44198895027624308,0.22105263157894739,0.28533333333333333,0.19886363636363635,0.26530612244897955,0.2265625,0.33014354066985641],"mode":"markers+text","text":["Gabrielle BARRAUT","Gabin LIBERCIER-CADOT","Gurvan HALDIMANN","Megane RUBAT","Solene DE DONATO","Guillaume COTTAREL","Marius LABUCHE","Cedric FLECK","Catherine JACQUIN","Camille SAVARY","Aimie BARA","Emma HEIMBURGER","Morgan MARTIN","Eloise MOULIN-TANGUY","Coline DUBOIS","Lea BETTINGER","Geoffrey CHERON","Georges ALLEN","Margaux LION","Florian BURTIN","Loic GRUIT","David FERREIRA","Laura ROUGEMONT","David ROLLAND","Matthieu DELCAMP","Vincent RICARD","Arnaud JULIEN","Damien NICOLAS","Julie LAMBREY","Aurelien GREAUME","Aline PETERMANN","Salome MIRA","Lea DE LA FONTAINE","Pauline CORPET","Matthieu BRISSAUD"],"textposition":["top center","top center","top center","top center","top center","top center","top center","top center","top center","top center","top center","top center","top center","top center","top center","top center","top center","top center","top center","top center","top center","top center","top center","top center","top center","top center","top center","top center","top center","top center","top center","top center","top center","top center","top center"],"marker":{"color":["#E41A1C","#377EB8","#377EB8","#E41A1C","#E41A1C","#377EB8","#377EB8","#377EB8","#E41A1C","#E41A1C","#E41A1C","#E41A1C","#377EB8","#E41A1C","#E41A1C","#E41A1C","#377EB8","#377EB8","#E41A1C","#377EB8","#377EB8","#377EB8","#E41A1C","#377EB8","#377EB8","#377EB8","#377EB8","#377EB8","#E41A1C","#377EB8","#E41A1C","#E41A1C","#E41A1C","#E41A1C","#377EB8"],"size":5,"opacity":0.80000000000000004,"line":{"color":"rgba(31,119,180,1)"}},"hovertemplate":["<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>","<b>%{text}<\/b><br> Sexe: %{customdata[0]}<br> Taux erreur: %{x}<br> Risque auto: %{y}<br> Non-détection: %{z}<br> <extra><\/extra>"],"customdata":[["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"],["f","m","m","f","f","m","m","m","f","f","f","f","m","f","f","f","m","m","f","m","m","m","f","m","m","m","m","m","f","m","f","f","f","f","m"]],"type":"scatter3d","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Corrélation</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>  tx_erreur_fin<span class="sc">$</span>tx_detect,</span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>  tx_erreur_fin<span class="sc">$</span>tx_erreur,</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"spearman"</span></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Spearman's rank correlation rho

data:  tx_erreur_fin$tx_detect and tx_erreur_fin$tx_erreur
S = 8162, p-value = 0.4106
alternative hypothesis: true rho is not equal to 0
sample estimates:
       rho 
-0.1431373 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Modèles linéaires</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>model1_autonotation <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>  risque_erreur <span class="sc">~</span> tx_erreur <span class="sc">+</span> tx_detect,</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> tx_erreur_fin</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>model2_autonotation <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>  risque_erreur <span class="sc">~</span> tx_detect,</span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> tx_erreur_fin</span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a>model3_autonotation <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a>  risque_erreur <span class="sc">~</span> tx_erreur,</span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> tx_erreur_fin</span>
<span id="cb112-18"><a href="#cb112-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb112-19"><a href="#cb112-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-20"><a href="#cb112-20" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1_autonotation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = risque_erreur ~ tx_erreur + tx_detect, data = tx_erreur_fin)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.41157 -0.12072  0.01905  0.15788  0.28155 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   0.9640     0.2192   4.399 0.000113 ***
tx_erreur     0.4721     0.3049   1.548 0.131381    
tx_detect    -0.6013     0.2984  -2.015 0.052332 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1836 on 32 degrees of freedom
Multiple R-squared:  0.2196,    Adjusted R-squared:  0.1708 
F-statistic: 4.503 on 2 and 32 DF,  p-value: 0.01892</code></pre>
</div>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model1_autonotation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: risque_erreur
          Df  Sum Sq  Mean Sq F value  Pr(&gt;F)  
tx_erreur  1 0.16664 0.166643  4.9437 0.03337 *
tx_detect  1 0.13691 0.136911  4.0617 0.05233 .
Residuals 32 1.07866 0.033708                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model2_autonotation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = risque_erreur ~ tx_detect, data = tx_erreur_fin)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.46667 -0.10872  0.00276  0.14115  0.27938 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   1.1387     0.1918   5.936 1.17e-06 ***
tx_detect    -0.7345     0.2917  -2.518   0.0168 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1874 on 33 degrees of freedom
Multiple R-squared:  0.1612,    Adjusted R-squared:  0.1357 
F-statistic:  6.34 on 1 and 33 DF,  p-value: 0.01684</code></pre>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model2_autonotation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: risque_erreur
          Df  Sum Sq  Mean Sq F value  Pr(&gt;F)  
tx_detect  1 0.22275 0.222746  6.3396 0.01684 *
Residuals 33 1.15947 0.035135                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model3_autonotation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = risque_erreur ~ tx_erreur, data = tx_erreur_fin)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.44548 -0.13246  0.04819  0.13963  0.27140 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.54089    0.06565   8.239 1.63e-09 ***
tx_erreur    0.64920    0.30522   2.127    0.041 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1919 on 33 degrees of freedom
Multiple R-squared:  0.1206,    Adjusted R-squared:  0.09391 
F-statistic: 4.524 on 1 and 33 DF,  p-value: 0.04099</code></pre>
</div>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model3_autonotation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: risque_erreur
          Df  Sum Sq  Mean Sq F value  Pr(&gt;F)  
tx_erreur  1 0.16664 0.166643   4.524 0.04099 *
Residuals 33 1.21557 0.036836                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparaison des modèles</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(model1_autonotation, model2_autonotation, model3_autonotation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    df       AIC
model1_autonotation  4 -14.46120
model2_autonotation  3 -13.93275
model3_autonotation  3 -12.27891</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="section-8" class="level1">
<h1>——————————-</h1>
</section>
<section id="v_-probabilité-de-détection" class="level1">
<h1>V_ Probabilité de détection</h1>
</section>
<section id="section-9" class="level1">
<h1>———————</h1>
<section id="v_i-glm" class="level2">
<h2 class="anchored" data-anchor-id="v_i-glm">V_i GLM</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On a plusieurs strates et on veut seulement une covariable "recouvrement". On utilise donc une ACP pour avec l'inertie sur PC1.</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraire juste les colonnes numériques pour la PCA</span></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>recouvrement_num <span class="ot">&lt;-</span> tab_complet <span class="sc">%&gt;%</span></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span>  <span class="co"># enlever le grouping</span></span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(S_muscinale<span class="sc">:</span>S_arborescente) <span class="sc">%&gt;%</span></span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), as.numeric)) <span class="sc">%&gt;%</span></span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Vérifier</span></span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(recouvrement_num)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   6660 obs. of  5 variables:
 $ S_muscinale      : num  1 1 1 1 1 1 1 1 1 1 ...
 $ S_herbacee       : num  10 10 10 10 10 10 10 10 10 10 ...
 $ S_arbustive_basse: num  5 5 5 5 5 5 5 5 5 5 ...
 $ S_arbustive_haute: num  2 2 2 2 2 2 2 2 2 2 ...
 $ S_arborescente   : num  1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>pca <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(recouvrement_num, <span class="at">scale. =</span> <span class="cn">TRUE</span>)</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajouter la première composante à ton tableau original</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>tab_complet<span class="sc">$</span>recouvrement_PC1 <span class="ot">&lt;-</span> pca<span class="sc">$</span>x[,<span class="dv">1</span>]</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a><span class="co"># GLM</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a><span class="co"># glm_model &lt;- glmer(</span></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   detection ~ recouvrement_PC1 + site + session + taille + phenologie_verif + </span></span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a><span class="co">#     (1 | ID_ind) + (1 | id_quadrat_fin),</span></span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   data = tab_complet,</span></span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   family = binomial</span></span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(glm_model)       # coefficients, significativité</span></span>
<span id="cb128-17"><a href="#cb128-17" aria-hidden="true" tabindex="-1"></a><span class="co"># anova(glm_model, test="Chisq")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sélection-de-modèles" class="level2">
<h2 class="anchored" data-anchor-id="sélection-de-modèles">Sélection de modèles</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Autoriser MuMIn à travailler avec glmer</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="co"># options(na.action = "na.fail")</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a><span class="co"># #modèle complet</span></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a><span class="co"># glm_model &lt;- glmer(</span></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   detection ~ recouvrement_PC1 + site + session + taille + phenologie_verif +</span></span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     (1 | ID_ind) + (1 | id_quadrat_fin),</span></span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   data = tab_complet,</span></span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   family = binomial</span></span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a><span class="co"># # Sélection de modèle (toutes combinaisons de variables fixes)</span></span>
<span id="cb129-13"><a href="#cb129-13" aria-hidden="true" tabindex="-1"></a><span class="co"># model_set &lt;- dredge(glm_model, trace = TRUE)</span></span>
<span id="cb129-14"><a href="#cb129-14" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb129-15"><a href="#cb129-15" aria-hidden="true" tabindex="-1"></a><span class="co"># # Afficher les modèles triés par AICc</span></span>
<span id="cb129-16"><a href="#cb129-16" aria-hidden="true" tabindex="-1"></a><span class="co"># model_set</span></span>
<span id="cb129-17"><a href="#cb129-17" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb129-18"><a href="#cb129-18" aria-hidden="true" tabindex="-1"></a><span class="co"># # Optionnel : extraire les meilleurs modèles avec delta AICc &lt; 2</span></span>
<span id="cb129-19"><a href="#cb129-19" aria-hidden="true" tabindex="-1"></a><span class="co"># best_models &lt;- get.models(model_set, subset = delta &lt; 2)</span></span>
<span id="cb129-20"><a href="#cb129-20" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb129-21"><a href="#cb129-21" aria-hidden="true" tabindex="-1"></a><span class="co"># # Afficher le résumé du meilleur modèle</span></span>
<span id="cb129-22"><a href="#cb129-22" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(best_models[[1]])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="section-10" class="level1">
<h1>———————</h1>
</section>
<section id="vii_-cmr" class="level1">
<h1>VII_ CMR <!--#  --></h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Résumer la phénologie en lettres pour crdms</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(tab_complet<span class="sc">$</span>phenologie_verif)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "juv"           "non_fleuri"    "fleur"         "fleurs_fanees"
[5] "fruit"         NA             </code></pre>
</div>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co">#filtrer pour garder seuelement lignes sans NA</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>tab_complet <span class="ot">&lt;-</span> tab_complet <span class="sc">%&gt;%</span></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(phenologie_verif))</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(tab_complet<span class="sc">$</span>phenologie_verif)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "juv"           "non_fleuri"    "fleur"         "fleurs_fanees"
[5] "fruit"        </code></pre>
</div>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>tab_complet <span class="ot">&lt;-</span> tab_complet <span class="sc">%&gt;%</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">phenologie =</span> <span class="fu">case_when</span>(</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>      phenologie_verif <span class="sc">==</span> <span class="st">"juv"</span> <span class="sc">~</span> <span class="st">"j"</span>,</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>      phenologie_verif <span class="sc">==</span> <span class="st">"non_fleuri"</span> <span class="sc">~</span> <span class="st">"nf"</span>,</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>      phenologie_verif <span class="sc">==</span> <span class="st">"fleur"</span> <span class="sc">~</span> <span class="st">"f"</span>,</span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>      phenologie_verif <span class="sc">==</span> <span class="st">"fruit"</span> <span class="sc">~</span> <span class="st">"F"</span>,</span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>      phenologie_verif <span class="sc">==</span> <span class="st">"fleurs_fanees"</span> <span class="sc">~</span> <span class="st">"ff"</span>,</span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Donner un chiffre à chaque observateur différent</span></span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a>tab_complet <span class="ot">&lt;-</span> tab_complet <span class="sc">%&gt;%</span></span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(session) <span class="sc">%&gt;%</span></span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sec =</span> <span class="fu">as.integer</span>(<span class="fu">factor</span>(observateur))) <span class="sc">%&gt;%</span></span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-19"><a href="#cb134-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Histoire de captures</span></span>
<span id="cb134-20"><a href="#cb134-20" aria-hidden="true" tabindex="-1"></a>ch_tab <span class="ot">&lt;-</span> tab_complet <span class="sc">%&gt;%</span></span>
<span id="cb134-21"><a href="#cb134-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(ID_ind, session, sec) <span class="sc">%&gt;%</span></span>
<span id="cb134-22"><a href="#cb134-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">obs =</span> <span class="fu">ifelse</span>(detection <span class="sc">==</span> <span class="dv">1</span>, phenologie, <span class="st">"0"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb134-23"><a href="#cb134-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID_ind, session) <span class="sc">%&gt;%</span></span>
<span id="cb134-24"><a href="#cb134-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">ch_sess =</span> <span class="fu">paste0</span>(obs, <span class="at">collapse =</span> <span class="st">""</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb134-25"><a href="#cb134-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-26"><a href="#cb134-26" aria-hidden="true" tabindex="-1"></a><span class="co">#prendre infos covariables</span></span>
<span id="cb134-27"><a href="#cb134-27" aria-hidden="true" tabindex="-1"></a>ind_cov <span class="ot">&lt;-</span> tab_complet <span class="sc">%&gt;%</span></span>
<span id="cb134-28"><a href="#cb134-28" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(ID_ind, session, site, quadrat, taille) <span class="sc">%&gt;%</span></span>
<span id="cb134-29"><a href="#cb134-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb134-30"><a href="#cb134-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-31"><a href="#cb134-31" aria-hidden="true" tabindex="-1"></a><span class="co">#ajouter l'info</span></span>
<span id="cb134-32"><a href="#cb134-32" aria-hidden="true" tabindex="-1"></a>ch_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(ch_tab, ind_cov, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ID_ind"</span>, <span class="st">"session"</span>))</span>
<span id="cb134-33"><a href="#cb134-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-34"><a href="#cb134-34" aria-hidden="true" tabindex="-1"></a><span class="co">#Concaténer les sessions pour avoir une seule histoire de capture</span></span>
<span id="cb134-35"><a href="#cb134-35" aria-hidden="true" tabindex="-1"></a>ch_data_final <span class="ot">&lt;-</span> ch_data <span class="sc">%&gt;%</span> </span>
<span id="cb134-36"><a href="#cb134-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID_ind) <span class="sc">%&gt;%</span> </span>
<span id="cb134-37"><a href="#cb134-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">ch=</span><span class="fu">paste</span>(ch_sess, <span class="at">collapse =</span> <span class="st">""</span>, <span class="at">.groups =</span> <span class="st">"drop"</span>))</span>
<span id="cb134-38"><a href="#cb134-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-39"><a href="#cb134-39" aria-hidden="true" tabindex="-1"></a><span class="co">#Ajouter les covariables fixes</span></span>
<span id="cb134-40"><a href="#cb134-40" aria-hidden="true" tabindex="-1"></a>cov_fixed <span class="ot">&lt;-</span> tab_complet <span class="sc">%&gt;%</span> </span>
<span id="cb134-41"><a href="#cb134-41" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(ID_ind, site, quadrat) <span class="sc">%&gt;%</span> </span>
<span id="cb134-42"><a href="#cb134-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb134-43"><a href="#cb134-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-44"><a href="#cb134-44" aria-hidden="true" tabindex="-1"></a>ch_data_final <span class="ot">&lt;-</span> <span class="fu">left_join</span>(ch_data_final, cov_fixed, <span class="at">by =</span> <span class="st">"ID_ind"</span>)</span>
<span id="cb134-45"><a href="#cb134-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-46"><a href="#cb134-46" aria-hidden="true" tabindex="-1"></a><span class="co">#nombre d'occasions secondaires par session</span></span>
<span id="cb134-47"><a href="#cb134-47" aria-hidden="true" tabindex="-1"></a>nocc <span class="ot">&lt;-</span> tab_complet <span class="sc">%&gt;%</span> </span>
<span id="cb134-48"><a href="#cb134-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(session, sec) <span class="sc">%&gt;%</span> </span>
<span id="cb134-49"><a href="#cb134-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(session) <span class="sc">%&gt;%</span> </span>
<span id="cb134-50"><a href="#cb134-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(session) <span class="sc">%&gt;%</span> </span>
<span id="cb134-51"><a href="#cb134-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(n)</span>
<span id="cb134-52"><a href="#cb134-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-53"><a href="#cb134-53" aria-hidden="true" tabindex="-1"></a><span class="co"># proc &lt;- process.data(</span></span>
<span id="cb134-54"><a href="#cb134-54" aria-hidden="true" tabindex="-1"></a><span class="co">#   ch_data_final,</span></span>
<span id="cb134-55"><a href="#cb134-55" aria-hidden="true" tabindex="-1"></a><span class="co">#   model = "crdms",</span></span>
<span id="cb134-56"><a href="#cb134-56" aria-hidden="true" tabindex="-1"></a><span class="co">#   nocc = nocc,</span></span>
<span id="cb134-57"><a href="#cb134-57" aria-hidden="true" tabindex="-1"></a><span class="co">#   strata.labels = c("j", "nf", "f", "F", "ff")</span></span>
<span id="cb134-58"><a href="#cb134-58" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-11" class="level1">
<h1>———————</h1>
<section id="vii_ianalyse-des-transitions-phénologiques-avec-et-sans-mark-vii_i.i-toutes-transitions" class="level2">
<h2 class="anchored" data-anchor-id="vii_ianalyse-des-transitions-phénologiques-avec-et-sans-mark-vii_i.i-toutes-transitions">VII_iAnalyse des transitions phénologiques avec et sans MARK ###VII_i.i Toutes transitions</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Charger les données</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span> data_original</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Préparer les données phénologiques</span></span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>phenology_codes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"j"</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"nf"</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">"f"</span> <span class="ot">=</span> <span class="dv">3</span>, <span class="st">"ff"</span> <span class="ot">=</span> <span class="dv">4</span>, <span class="st">"F"</span> <span class="ot">=</span> <span class="dv">5</span>)</span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>phenology_data_numeric <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(ID_ind, phenoS1, phenoS2, phenoS3) <span class="sc">%&gt;%</span></span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb135-14"><a href="#cb135-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">phenoS1 =</span> phenology_codes[phenoS1],</span>
<span id="cb135-15"><a href="#cb135-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">phenoS2 =</span> phenology_codes[phenoS2],</span>
<span id="cb135-16"><a href="#cb135-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">phenoS3 =</span> phenology_codes[phenoS3]</span>
<span id="cb135-17"><a href="#cb135-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb135-18"><a href="#cb135-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-19"><a href="#cb135-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Supprimer les individus avec NA dans phenoS1, phenoS2 ou phenoS3</span></span>
<span id="cb135-20"><a href="#cb135-20" aria-hidden="true" tabindex="-1"></a>phenology_data_numeric <span class="ot">&lt;-</span> phenology_data_numeric <span class="sc">%&gt;%</span></span>
<span id="cb135-21"><a href="#cb135-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(phenoS1) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(phenoS2) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(phenoS3))</span>
<span id="cb135-22"><a href="#cb135-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-23"><a href="#cb135-23" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb135-24"><a href="#cb135-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Calcul empirique des transitions 1 → 2 → 3</span></span>
<span id="cb135-25"><a href="#cb135-25" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb135-26"><a href="#cb135-26" aria-hidden="true" tabindex="-1"></a>phenology_long <span class="ot">&lt;-</span> phenology_data_numeric <span class="sc">%&gt;%</span></span>
<span id="cb135-27"><a href="#cb135-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(phenoS1, phenoS2, phenoS3),</span>
<span id="cb135-28"><a href="#cb135-28" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"session"</span>,</span>
<span id="cb135-29"><a href="#cb135-29" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"state"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb135-30"><a href="#cb135-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">session =</span> <span class="fu">as.integer</span>(<span class="fu">gsub</span>(<span class="st">"phenoS"</span>, <span class="st">""</span>, session)))</span>
<span id="cb135-31"><a href="#cb135-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-32"><a href="#cb135-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculer les transitions successives</span></span>
<span id="cb135-33"><a href="#cb135-33" aria-hidden="true" tabindex="-1"></a>transitions <span class="ot">&lt;-</span> phenology_long <span class="sc">%&gt;%</span></span>
<span id="cb135-34"><a href="#cb135-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID_ind) <span class="sc">%&gt;%</span></span>
<span id="cb135-35"><a href="#cb135-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(session) <span class="sc">%&gt;%</span></span>
<span id="cb135-36"><a href="#cb135-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">next_state =</span> <span class="fu">lead</span>(state)) <span class="sc">%&gt;%</span></span>
<span id="cb135-37"><a href="#cb135-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(next_state)) <span class="sc">%&gt;%</span></span>
<span id="cb135-38"><a href="#cb135-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(state, next_state) <span class="sc">%&gt;%</span></span>
<span id="cb135-39"><a href="#cb135-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">%&gt;%</span></span>
<span id="cb135-40"><a href="#cb135-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n))</span>
<span id="cb135-41"><a href="#cb135-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-42"><a href="#cb135-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Créer la matrice 5x5</span></span>
<span id="cb135-43"><a href="#cb135-43" aria-hidden="true" tabindex="-1"></a>num_states <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb135-44"><a href="#cb135-44" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"j"</span>,<span class="st">"nf"</span>,<span class="st">"f"</span>,<span class="st">"ff"</span>,<span class="st">"F"</span>)</span>
<span id="cb135-45"><a href="#cb135-45" aria-hidden="true" tabindex="-1"></a>Psi_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow=</span>num_states, <span class="at">ncol=</span>num_states, <span class="at">dimnames =</span> <span class="fu">list</span>(states, states))</span>
<span id="cb135-46"><a href="#cb135-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-47"><a href="#cb135-47" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_states){</span>
<span id="cb135-48"><a href="#cb135-48" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_states){</span>
<span id="cb135-49"><a href="#cb135-49" aria-hidden="true" tabindex="-1"></a>    val <span class="ot">&lt;-</span> transitions <span class="sc">%&gt;%</span> <span class="fu">filter</span>(state <span class="sc">==</span> i, next_state <span class="sc">==</span> j) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(prob)</span>
<span id="cb135-50"><a href="#cb135-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(val) <span class="sc">&gt;</span> <span class="dv">0</span>) Psi_matrix[i,j] <span class="ot">&lt;-</span> <span class="fu">mean</span>(val)</span>
<span id="cb135-51"><a href="#cb135-51" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb135-52"><a href="#cb135-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb135-53"><a href="#cb135-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-54"><a href="#cb135-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalisation par ligne</span></span>
<span id="cb135-55"><a href="#cb135-55" aria-hidden="true" tabindex="-1"></a>Psi_matrix_norm <span class="ot">&lt;-</span> Psi_matrix <span class="sc">/</span> <span class="fu">rowSums</span>(Psi_matrix)</span>
<span id="cb135-56"><a href="#cb135-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-57"><a href="#cb135-57" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb135-58"><a href="#cb135-58" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Visualisation avec DiagrammeR</span></span>
<span id="cb135-59"><a href="#cb135-59" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb135-60"><a href="#cb135-60" aria-hidden="true" tabindex="-1"></a>dot_code <span class="ot">&lt;-</span> <span class="st">"digraph pheno_transitions { </span></span>
<span id="cb135-61"><a href="#cb135-61" aria-hidden="true" tabindex="-1"></a><span class="st">  rankdir=LR;</span></span>
<span id="cb135-62"><a href="#cb135-62" aria-hidden="true" tabindex="-1"></a><span class="st">  node [shape=circle, style=filled, color=lightblue, fontname=Helvetica];</span></span>
<span id="cb135-63"><a href="#cb135-63" aria-hidden="true" tabindex="-1"></a><span class="st">  j; nf; f; ff; F;</span></span>
<span id="cb135-64"><a href="#cb135-64" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span>
<span id="cb135-65"><a href="#cb135-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-66"><a href="#cb135-66" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_states){</span>
<span id="cb135-67"><a href="#cb135-67" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_states){</span>
<span id="cb135-68"><a href="#cb135-68" aria-hidden="true" tabindex="-1"></a>    prob <span class="ot">&lt;-</span> Psi_matrix_norm[i,j]</span>
<span id="cb135-69"><a href="#cb135-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(prob) <span class="sc">&amp;&amp;</span> prob <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb135-70"><a href="#cb135-70" aria-hidden="true" tabindex="-1"></a>      dot_code <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dot_code, states[i], <span class="st">" -&gt; "</span>, states[j], </span>
<span id="cb135-71"><a href="#cb135-71" aria-hidden="true" tabindex="-1"></a>                         <span class="st">" [label=</span><span class="sc">\"</span><span class="st">"</span>, <span class="fu">round</span>(prob, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\"</span><span class="st">];</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb135-72"><a href="#cb135-72" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb135-73"><a href="#cb135-73" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb135-74"><a href="#cb135-74" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb135-75"><a href="#cb135-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-76"><a href="#cb135-76" aria-hidden="true" tabindex="-1"></a>dot_code <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dot_code, <span class="st">"}"</span>)</span>
<span id="cb135-77"><a href="#cb135-77" aria-hidden="true" tabindex="-1"></a><span class="fu">grViz</span>(dot_code)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="grViz html-widget html-fill-item" id="htmlwidget-a375d03c4379de7c159b" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-a375d03c4379de7c159b">{"x":{"diagram":"digraph pheno_transitions { \n  rankdir=LR;\n  node [shape=circle, style=filled, color=lightblue, fontname=Helvetica];\n  j; nf; f; ff; F;\nj -> j [label=\"0.38\"];\nj -> nf [label=\"0.21\"];\nj -> f [label=\"0.21\"];\nj -> ff [label=\"0.21\"];\nnf -> j [label=\"0.18\"];\nnf -> nf [label=\"0.28\"];\nnf -> f [label=\"0.18\"];\nnf -> ff [label=\"0.18\"];\nnf -> F [label=\"0.18\"];\nf -> f [label=\"0.33\"];\nf -> ff [label=\"0.33\"];\nf -> F [label=\"0.33\"];\nff -> ff [label=\"1\"];\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Créer le champ "ch" pour MARK</span></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>phenology_data_numeric <span class="ot">&lt;-</span> phenology_data_numeric <span class="sc">%&gt;%</span></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ch =</span> <span class="fu">paste0</span>(phenoS1, phenoS2, phenoS3))</span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Vérification</span></span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">nchar</span>(phenology_data_numeric<span class="sc">$</span>ch) <span class="sc">==</span> <span class="dv">3</span>))</span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Préparer les données pour RMark</span></span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a>ms_data <span class="ot">&lt;-</span> <span class="fu">process.data</span>(</span>
<span id="cb136-14"><a href="#cb136-14" aria-hidden="true" tabindex="-1"></a>  phenology_data_numeric,</span>
<span id="cb136-15"><a href="#cb136-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">"Multistrata"</span>,</span>
<span id="cb136-16"><a href="#cb136-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">strata.labels =</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"5"</span>)</span>
<span id="cb136-17"><a href="#cb136-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb136-18"><a href="#cb136-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-19"><a href="#cb136-19" aria-hidden="true" tabindex="-1"></a>ms_ddl <span class="ot">&lt;-</span> <span class="fu">make.design.data</span>(ms_data)</span>
<span id="cb136-20"><a href="#cb136-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-21"><a href="#cb136-21" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb136-22"><a href="#cb136-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. Modèle Multistrata avec RMark</span></span>
<span id="cb136-23"><a href="#cb136-23" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb136-24"><a href="#cb136-24" aria-hidden="true" tabindex="-1"></a>ms_model <span class="ot">&lt;-</span> <span class="fu">mark</span>(</span>
<span id="cb136-25"><a href="#cb136-25" aria-hidden="true" tabindex="-1"></a>  ms_data,</span>
<span id="cb136-26"><a href="#cb136-26" aria-hidden="true" tabindex="-1"></a>  ms_ddl,</span>
<span id="cb136-27"><a href="#cb136-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">model.parameters =</span> <span class="fu">list</span>(</span>
<span id="cb136-28"><a href="#cb136-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">Psi =</span> <span class="fu">list</span>(<span class="at">formula =</span> <span class="sc">~</span>stratum),</span>
<span id="cb136-29"><a href="#cb136-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">p =</span> <span class="fu">list</span>(<span class="at">formula =</span> <span class="sc">~</span><span class="dv">1</span>)</span>
<span id="cb136-30"><a href="#cb136-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb136-31"><a href="#cb136-31" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Output summary for Multistrata model
Name : S(~stratum)p(~1)Psi(~stratum) 

Npar :  9
-2lnL:  1260.475
AICc :  1268.532

Beta
                   estimate  se         lcl         ucl
S:(Intercept)    22.4822490   0  22.4822490  22.4822490
S:stratum2        3.5457813   0   3.5457813   3.5457813
S:stratum3       -3.1771435   0  -3.1771435  -3.1771435
S:stratum4       -0.0288477   0  -0.0288477  -0.0288477
S:stratum5        0.0000000   0   0.0000000   0.0000000
p:(Intercept)    24.6495650   0  24.6495650  24.6495650
Psi:(Intercept)  -1.8898207   0  -1.8898207  -1.8898207
Psi:stratum2     -1.3140412   0  -1.3140412  -1.3140412
Psi:stratum3      1.9205923   0   1.9205923   1.9205923
Psi:stratum4    -25.2313770   0 -25.2313770 -25.2313770
Psi:stratum5      0.0000000 Inf        -Inf         Inf


Real Parameter S
 Stratum:1 
  1 2
1 1 1
2   1

 Stratum:2 
  1 2
1 1 1
2   1

 Stratum:3 
  1 2
1 1 1
2   1

 Stratum:4 
  1 2
1 1 1
2   1

 Stratum:5 
  1 2
1 1 1
2   1


Real Parameter p
 Stratum:1 
  2 3
1 1 1
2   1

 Stratum:2 
  2 3
1 1 1
2   1

 Stratum:3 
  2 3
1 1 1
2   1

 Stratum:4 
  2 3
1 1 1
2   1

 Stratum:5 
  2 3
1 1 1
2   1


Real Parameter Psi
 Stratum:1 To:2 
          1         2
1 0.0941781 0.0941781
2           0.0941781

 Stratum:1 To:3 
          1         2
1 0.0941781 0.0941781
2           0.0941781

 Stratum:1 To:4 
          1         2
1 0.0941781 0.0941781
2           0.0941781

 Stratum:1 To:5 
          1         2
1 0.0941781 0.0941781
2           0.0941781

 Stratum:2 To:1 
          1         2
1 0.0349315 0.0349315
2           0.0349315

 Stratum:2 To:3 
          1         2
1 0.0349315 0.0349315
2           0.0349315

 Stratum:2 To:4 
          1         2
1 0.0349315 0.0349315
2           0.0349315

 Stratum:2 To:5 
          1         2
1 0.0349315 0.0349315
2           0.0349315

 Stratum:3 To:1 
          1         2
1 0.2012195 0.2012195
2           0.2012195

 Stratum:3 To:2 
          1         2
1 0.2012195 0.2012195
2           0.2012195

 Stratum:3 To:4 
          1         2
1 0.2012195 0.2012195
2           0.2012195

 Stratum:3 To:5 
          1         2
1 0.2012195 0.2012195
2           0.2012195

 Stratum:4 To:1 
             1            2
1 1.664997e-12 1.664997e-12
2              1.664997e-12

 Stratum:4 To:2 
             1            2
1 1.664997e-12 1.664997e-12
2              1.664997e-12

 Stratum:4 To:3 
             1            2
1 1.664997e-12 1.664997e-12
2              1.664997e-12

 Stratum:4 To:5 
             1            2
1 1.664997e-12 1.664997e-12
2              1.664997e-12

 Stratum:5 To:1 
          1         2
1 0.0941781 0.0941781
2           0.0941781

 Stratum:5 To:2 
          1         2
1 0.0941781 0.0941781
2           0.0941781

 Stratum:5 To:3 
          1         2
1 0.0941781 0.0941781
2           0.0941781

 Stratum:5 To:4 
          1         2
1 0.0941781 0.0941781
2           0.0941781</code></pre>
</div>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Résultats MARK</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>ms_model<span class="sc">$</span>results<span class="sc">$</span>real</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                              estimate se lcl           ucl fixed note
S s1 g1 c1 a0 o1 t1       1.000000e+00  0   0  0.000000e+00           
S s2 g1 c1 a0 o1 t1       1.000000e+00  0   0  0.000000e+00           
S s3 g1 c1 a0 o1 t1       1.000000e+00  0   0  0.000000e+00           
S s4 g1 c1 a0 o1 t1       1.000000e+00  0   0  0.000000e+00           
S s5 g1 c1 a0 o1 t1       1.000000e+00  0   0  0.000000e+00           
p s1 g1 c1 a1 o1 t2       1.000000e+00  0   0  0.000000e+00           
Psi s1 to2 g1 c1 a0 o1 t1 9.417810e-02  0   1 2.313404e-309           
Psi s1 to2 g1 c1 a1 o2 t2 9.417810e-02  0   1 2.313404e-309           
Psi s1 to2 g1 c2 a0 o2 t2 9.417810e-02  0   1 2.313404e-309           
Psi s1 to3 g1 c1 a0 o1 t1 9.417810e-02  0   1 2.313404e-309           
Psi s1 to3 g1 c1 a1 o2 t2 9.417810e-02  0   1 2.313404e-309           
Psi s1 to3 g1 c2 a0 o2 t2 9.417810e-02  0   1 2.313404e-309           
Psi s1 to4 g1 c1 a0 o1 t1 9.417810e-02  0   1 2.313404e-309           
Psi s1 to4 g1 c1 a1 o2 t2 9.417810e-02  0   1 2.313404e-309           
Psi s1 to4 g1 c2 a0 o2 t2 9.417810e-02  0   1 2.313404e-309           
Psi s1 to5 g1 c1 a0 o1 t1 9.417810e-02  0   1 2.313404e-309           
Psi s1 to5 g1 c1 a1 o2 t2 9.417810e-02  0   1 2.313404e-309           
Psi s1 to5 g1 c2 a0 o2 t2 9.417810e-02  0   1 2.313404e-309           
Psi s2 to1 g1 c1 a0 o1 t1 3.493150e-02  0   1 8.053851e-310           
Psi s2 to1 g1 c1 a1 o2 t2 3.493150e-02  0   1 8.053851e-310           
Psi s2 to1 g1 c2 a0 o2 t2 3.493150e-02  0   1 8.053851e-310           
Psi s2 to3 g1 c1 a0 o1 t1 3.493150e-02  0   1 8.053851e-310           
Psi s2 to3 g1 c1 a1 o2 t2 3.493150e-02  0   1 8.053851e-310           
Psi s2 to3 g1 c2 a0 o2 t2 3.493150e-02  0   1 8.053851e-310           
Psi s2 to4 g1 c1 a0 o1 t1 3.493150e-02  0   1 8.053851e-310           
Psi s2 to4 g1 c1 a1 o2 t2 3.493150e-02  0   1 8.053851e-310           
Psi s2 to4 g1 c2 a0 o2 t2 3.493150e-02  0   1 8.053851e-310           
Psi s2 to5 g1 c1 a0 o1 t1 3.493150e-02  0   1 8.053851e-310           
Psi s2 to5 g1 c1 a1 o2 t2 3.493150e-02  0   1 8.053851e-310           
Psi s2 to5 g1 c2 a0 o2 t2 3.493150e-02  0   1 8.053851e-310           
Psi s3 to1 g1 c1 a0 o1 t1 2.012195e-01  0   1 5.605148e-309           
Psi s3 to1 g1 c1 a1 o2 t2 2.012195e-01  0   1 5.605148e-309           
Psi s3 to1 g1 c2 a0 o2 t2 2.012195e-01  0   1 5.605148e-309           
Psi s3 to2 g1 c1 a0 o1 t1 2.012195e-01  0   1 5.605148e-309           
Psi s3 to2 g1 c1 a1 o2 t2 2.012195e-01  0   1 5.605148e-309           
Psi s3 to2 g1 c2 a0 o2 t2 2.012195e-01  0   1 5.605148e-309           
Psi s3 to4 g1 c1 a0 o1 t1 2.012195e-01  0   1 5.605148e-309           
Psi s3 to4 g1 c1 a1 o2 t2 2.012195e-01  0   1 5.605148e-309           
Psi s3 to4 g1 c2 a0 o2 t2 2.012195e-01  0   1 5.605148e-309           
Psi s3 to5 g1 c1 a0 o1 t1 2.012195e-01  0   1 5.605148e-309           
Psi s3 to5 g1 c1 a1 o2 t2 2.012195e-01  0   1 5.605148e-309           
Psi s3 to5 g1 c2 a0 o2 t2 2.012195e-01  0   1 5.605148e-309           
Psi s4 to1 g1 c1 a0 o1 t1 1.664997e-12  0   0  0.000000e+00           
Psi s4 to1 g1 c1 a1 o2 t2 1.664997e-12  0   0  0.000000e+00           
Psi s4 to1 g1 c2 a0 o2 t2 1.664997e-12  0   0  0.000000e+00           
Psi s4 to2 g1 c1 a0 o1 t1 1.664997e-12  0   0  0.000000e+00           
Psi s4 to2 g1 c1 a1 o2 t2 1.664997e-12  0   0  0.000000e+00           
Psi s4 to2 g1 c2 a0 o2 t2 1.664997e-12  0   0  0.000000e+00           
Psi s4 to3 g1 c1 a0 o1 t1 1.664997e-12  0   0  0.000000e+00           
Psi s4 to3 g1 c1 a1 o2 t2 1.664997e-12  0   0  0.000000e+00           
Psi s4 to3 g1 c2 a0 o2 t2 1.664997e-12  0   0  0.000000e+00           
Psi s4 to5 g1 c1 a0 o1 t1 1.664997e-12  0   0  0.000000e+00           
Psi s4 to5 g1 c1 a1 o2 t2 1.664997e-12  0   0  0.000000e+00           
Psi s4 to5 g1 c2 a0 o2 t2 1.664997e-12  0   0  0.000000e+00           
Psi s5 to1 g1 c1 a0 o1 t1 9.417810e-02  0   1 2.313404e-309           
Psi s5 to1 g1 c1 a1 o2 t2 9.417810e-02  0   1 2.313404e-309           
Psi s5 to1 g1 c2 a0 o2 t2 9.417810e-02  0   1 2.313404e-309           
Psi s5 to2 g1 c1 a0 o1 t1 9.417810e-02  0   1 2.313404e-309           
Psi s5 to2 g1 c1 a1 o2 t2 9.417810e-02  0   1 2.313404e-309           
Psi s5 to2 g1 c2 a0 o2 t2 9.417810e-02  0   1 2.313404e-309           
Psi s5 to3 g1 c1 a0 o1 t1 9.417810e-02  0   1 2.313404e-309           
Psi s5 to3 g1 c1 a1 o2 t2 9.417810e-02  0   1 2.313404e-309           
Psi s5 to3 g1 c2 a0 o2 t2 9.417810e-02  0   1 2.313404e-309           
Psi s5 to4 g1 c1 a0 o1 t1 9.417810e-02  0   1 2.313404e-309           
Psi s5 to4 g1 c1 a1 o2 t2 9.417810e-02  0   1 2.313404e-309           
Psi s5 to4 g1 c2 a0 o2 t2 9.417810e-02  0   1 2.313404e-309           </code></pre>
</div>
</div>
<section id="vii_i.ii-transitions-session-1-2" class="level3">
<h3 class="anchored" data-anchor-id="vii_i.ii-transitions-session-1-2">VII_i.ii Transitions session 1 → 2</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="do">###MARK Session 1-2 ----</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Charger les données</span></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data_original</span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Préparer les données phénologiques (sessions 1 et 2)</span></span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a>phenology_codes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"j"</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"nf"</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">"f"</span> <span class="ot">=</span> <span class="dv">3</span>, <span class="st">"ff"</span> <span class="ot">=</span> <span class="dv">4</span>, <span class="st">"F"</span> <span class="ot">=</span> <span class="dv">5</span>)</span>
<span id="cb140-12"><a href="#cb140-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-13"><a href="#cb140-13" aria-hidden="true" tabindex="-1"></a>phenology_data_numeric <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb140-14"><a href="#cb140-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(ID_ind, phenoS1, phenoS2) <span class="sc">%&gt;%</span></span>
<span id="cb140-15"><a href="#cb140-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb140-16"><a href="#cb140-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">phenoS1 =</span> <span class="fu">as.character</span>(phenology_codes[phenoS1]),</span>
<span id="cb140-17"><a href="#cb140-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">phenoS2 =</span> <span class="fu">as.character</span>(phenology_codes[phenoS2])</span>
<span id="cb140-18"><a href="#cb140-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb140-19"><a href="#cb140-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Supprimer les individus avec NA dans phenoS1 ou phenoS2</span></span>
<span id="cb140-20"><a href="#cb140-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(phenoS1) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(phenoS2))</span>
<span id="cb140-21"><a href="#cb140-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-22"><a href="#cb140-22" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb140-23"><a href="#cb140-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Calcul empirique des transitions 1 → 2</span></span>
<span id="cb140-24"><a href="#cb140-24" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb140-25"><a href="#cb140-25" aria-hidden="true" tabindex="-1"></a>phenology_long <span class="ot">&lt;-</span> phenology_data_numeric <span class="sc">%&gt;%</span></span>
<span id="cb140-26"><a href="#cb140-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(phenoS1, phenoS2),</span>
<span id="cb140-27"><a href="#cb140-27" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"session"</span>,</span>
<span id="cb140-28"><a href="#cb140-28" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"state"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb140-29"><a href="#cb140-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">session =</span> <span class="fu">as.integer</span>(<span class="fu">gsub</span>(<span class="st">"phenoS"</span>, <span class="st">""</span>, session)))</span>
<span id="cb140-30"><a href="#cb140-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-31"><a href="#cb140-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Transitions successives</span></span>
<span id="cb140-32"><a href="#cb140-32" aria-hidden="true" tabindex="-1"></a>transitions <span class="ot">&lt;-</span> phenology_long <span class="sc">%&gt;%</span></span>
<span id="cb140-33"><a href="#cb140-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID_ind) <span class="sc">%&gt;%</span></span>
<span id="cb140-34"><a href="#cb140-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(session) <span class="sc">%&gt;%</span></span>
<span id="cb140-35"><a href="#cb140-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">next_state =</span> <span class="fu">lead</span>(state)) <span class="sc">%&gt;%</span></span>
<span id="cb140-36"><a href="#cb140-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(next_state)) <span class="sc">%&gt;%</span></span>
<span id="cb140-37"><a href="#cb140-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(state, next_state) <span class="sc">%&gt;%</span></span>
<span id="cb140-38"><a href="#cb140-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">%&gt;%</span></span>
<span id="cb140-39"><a href="#cb140-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n))</span>
<span id="cb140-40"><a href="#cb140-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-41"><a href="#cb140-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Créer la matrice 5x5</span></span>
<span id="cb140-42"><a href="#cb140-42" aria-hidden="true" tabindex="-1"></a>num_states <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb140-43"><a href="#cb140-43" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"j"</span>,<span class="st">"nf"</span>,<span class="st">"f"</span>,<span class="st">"ff"</span>,<span class="st">"F"</span>)</span>
<span id="cb140-44"><a href="#cb140-44" aria-hidden="true" tabindex="-1"></a>Psi_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow=</span>num_states, <span class="at">ncol=</span>num_states, <span class="at">dimnames =</span> <span class="fu">list</span>(states, states))</span>
<span id="cb140-45"><a href="#cb140-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-46"><a href="#cb140-46" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_states){</span>
<span id="cb140-47"><a href="#cb140-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_states){</span>
<span id="cb140-48"><a href="#cb140-48" aria-hidden="true" tabindex="-1"></a>    val <span class="ot">&lt;-</span> transitions <span class="sc">%&gt;%</span> <span class="fu">filter</span>(state <span class="sc">==</span> i, next_state <span class="sc">==</span> j) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(prob)</span>
<span id="cb140-49"><a href="#cb140-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(val) <span class="sc">&gt;</span> <span class="dv">0</span>) Psi_matrix[i,j] <span class="ot">&lt;-</span> <span class="fu">mean</span>(val)</span>
<span id="cb140-50"><a href="#cb140-50" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb140-51"><a href="#cb140-51" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb140-52"><a href="#cb140-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-53"><a href="#cb140-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalisation par ligne</span></span>
<span id="cb140-54"><a href="#cb140-54" aria-hidden="true" tabindex="-1"></a>Psi_matrix_norm <span class="ot">&lt;-</span> Psi_matrix <span class="sc">/</span> <span class="fu">rowSums</span>(Psi_matrix)</span>
<span id="cb140-55"><a href="#cb140-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-56"><a href="#cb140-56" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb140-57"><a href="#cb140-57" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Visualisation des transitions avec DiagrammeR</span></span>
<span id="cb140-58"><a href="#cb140-58" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb140-59"><a href="#cb140-59" aria-hidden="true" tabindex="-1"></a>dot_code <span class="ot">&lt;-</span> <span class="st">"digraph pheno_transitions { </span></span>
<span id="cb140-60"><a href="#cb140-60" aria-hidden="true" tabindex="-1"></a><span class="st">  rankdir=LR;</span></span>
<span id="cb140-61"><a href="#cb140-61" aria-hidden="true" tabindex="-1"></a><span class="st">  node [shape=circle, style=filled, color=lightblue, fontname=Helvetica];</span></span>
<span id="cb140-62"><a href="#cb140-62" aria-hidden="true" tabindex="-1"></a><span class="st">  j; nf; f; ff; F;</span></span>
<span id="cb140-63"><a href="#cb140-63" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span>
<span id="cb140-64"><a href="#cb140-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-65"><a href="#cb140-65" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_states){</span>
<span id="cb140-66"><a href="#cb140-66" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_states){</span>
<span id="cb140-67"><a href="#cb140-67" aria-hidden="true" tabindex="-1"></a>    prob <span class="ot">&lt;-</span> Psi_matrix_norm[i,j]</span>
<span id="cb140-68"><a href="#cb140-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(prob) <span class="sc">&amp;&amp;</span> prob <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb140-69"><a href="#cb140-69" aria-hidden="true" tabindex="-1"></a>      dot_code <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dot_code, states[i], <span class="st">" -&gt; "</span>, states[j], </span>
<span id="cb140-70"><a href="#cb140-70" aria-hidden="true" tabindex="-1"></a>                         <span class="st">" [label=</span><span class="sc">\"</span><span class="st">"</span>, <span class="fu">round</span>(prob, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\"</span><span class="st">];</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb140-71"><a href="#cb140-71" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb140-72"><a href="#cb140-72" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb140-73"><a href="#cb140-73" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb140-74"><a href="#cb140-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-75"><a href="#cb140-75" aria-hidden="true" tabindex="-1"></a>dot_code <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dot_code, <span class="st">"}"</span>)</span>
<span id="cb140-76"><a href="#cb140-76" aria-hidden="true" tabindex="-1"></a><span class="fu">grViz</span>(dot_code)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="grViz html-widget html-fill-item" id="htmlwidget-bed1bf7a493a6354b2dd" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-bed1bf7a493a6354b2dd">{"x":{"diagram":"digraph pheno_transitions { \n  rankdir=LR;\n  node [shape=circle, style=filled, color=lightblue, fontname=Helvetica];\n  j; nf; f; ff; F;\nj -> j [label=\"0.25\"];\nj -> nf [label=\"0.25\"];\nj -> f [label=\"0.25\"];\nj -> ff [label=\"0.25\"];\nnf -> j [label=\"0.33\"];\nnf -> nf [label=\"0.33\"];\nnf -> f [label=\"0.33\"];\nf -> f [label=\"0.5\"];\nf -> ff [label=\"0.5\"];\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Partie RMark</span></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Créer le champ "ch" pour MARK</span></span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>phenology_data_numeric <span class="ot">&lt;-</span> phenology_data_numeric <span class="sc">%&gt;%</span></span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ch =</span> <span class="fu">paste0</span>(phenoS1, phenoS2))</span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Vérification</span></span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">nchar</span>(phenology_data_numeric<span class="sc">$</span>ch) <span class="sc">==</span> <span class="dv">2</span>))</span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Préparer les données pour RMark</span></span>
<span id="cb141-12"><a href="#cb141-12" aria-hidden="true" tabindex="-1"></a>ms_data <span class="ot">&lt;-</span> <span class="fu">process.data</span>(</span>
<span id="cb141-13"><a href="#cb141-13" aria-hidden="true" tabindex="-1"></a>  phenology_data_numeric,</span>
<span id="cb141-14"><a href="#cb141-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">"Multistrata"</span>,</span>
<span id="cb141-15"><a href="#cb141-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">strata.labels =</span> <span class="fu">c</span>(<span class="st">"1"</span>,<span class="st">"2"</span>,<span class="st">"3"</span>,<span class="st">"4"</span>,<span class="st">"5"</span>)</span>
<span id="cb141-16"><a href="#cb141-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb141-17"><a href="#cb141-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-18"><a href="#cb141-18" aria-hidden="true" tabindex="-1"></a>ms_ddl <span class="ot">&lt;-</span> <span class="fu">make.design.data</span>(ms_data)</span>
<span id="cb141-19"><a href="#cb141-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-20"><a href="#cb141-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Modèle Multistrata avec RMark</span></span>
<span id="cb141-21"><a href="#cb141-21" aria-hidden="true" tabindex="-1"></a>ms_model <span class="ot">&lt;-</span> <span class="fu">mark</span>(</span>
<span id="cb141-22"><a href="#cb141-22" aria-hidden="true" tabindex="-1"></a>  ms_data,</span>
<span id="cb141-23"><a href="#cb141-23" aria-hidden="true" tabindex="-1"></a>  ms_ddl,</span>
<span id="cb141-24"><a href="#cb141-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">model.parameters =</span> <span class="fu">list</span>(</span>
<span id="cb141-25"><a href="#cb141-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">Psi =</span> <span class="fu">list</span>(<span class="at">formula =</span> <span class="sc">~</span>stratum),</span>
<span id="cb141-26"><a href="#cb141-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">p =</span> <span class="fu">list</span>(<span class="at">formula =</span> <span class="sc">~</span><span class="dv">1</span>)</span>
<span id="cb141-27"><a href="#cb141-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb141-28"><a href="#cb141-28" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Note: only 4 parameters counted of 7 specified parameters</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>AICc and parameter count have been adjusted upward</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Output summary for Multistrata model
Name : S(~stratum)p(~1)Psi(~stratum) 

Npar :  7  (unadjusted=4)
-2lnL:  776.6148
AICc :  790.9357  (unadjusted=784.7284)

Beta
                  estimate se        lcl        ucl
S:(Intercept)   22.9670610  0 22.9670610 22.9670610
S:stratum2       2.6412580  0  2.6412580  2.6412580
S:stratum3      -0.0303411  0 -0.0303411 -0.0303411
S:stratum4       0.0000000  0  0.0000000  0.0000000
S:stratum5       0.0000000  0  0.0000000  0.0000000
p:(Intercept)   24.1024080  0 24.1024080 24.1024080
Psi:(Intercept) -1.3144686  0 -1.3144686 -1.3144686
Psi:stratum2    -1.6122708  0 -1.6122708 -1.6122708
Psi:stratum3    -2.1512671  0 -2.1512671 -2.1512671
Psi:stratum4     0.0000000  0  0.0000000  0.0000000
Psi:stratum5     0.0000000  0  0.0000000  0.0000000


Real Parameter S
 Stratum:1 
  1
1 1

 Stratum:2 
  1
1 1

 Stratum:3 
  1
1 1

 Stratum:4 
  1
1 1

 Stratum:5 
  1
1 1


Real Parameter p
 Stratum:1 
  2
1 1

 Stratum:2 
  2
1 1

 Stratum:3 
  2
1 1

 Stratum:4 
  2
1 1

 Stratum:5 
  2
1 1


Real Parameter Psi
 Stratum:1 To:2 
          1
1 0.1294872

 Stratum:1 To:3 
          1
1 0.1294872

 Stratum:1 To:4 
          1
1 0.1294872

 Stratum:1 To:5 
          1
1 0.1294872

 Stratum:2 To:1 
          1
1 0.0441176

 Stratum:2 To:3 
          1
1 0.0441176

 Stratum:2 To:4 
          1
1 0.0441176

 Stratum:2 To:5 
          1
1 0.0441176

 Stratum:3 To:1 
          1
1 0.0277778

 Stratum:3 To:2 
          1
1 0.0277778

 Stratum:3 To:4 
          1
1 0.0277778

 Stratum:3 To:5 
          1
1 0.0277778

 Stratum:4 To:1 
          1
1 0.1294872

 Stratum:4 To:2 
          1
1 0.1294872

 Stratum:4 To:3 
          1
1 0.1294872

 Stratum:4 To:5 
          1
1 0.1294872

 Stratum:5 To:1 
          1
1 0.1294872

 Stratum:5 To:2 
          1
1 0.1294872

 Stratum:5 To:3 
          1
1 0.1294872

 Stratum:5 To:4 
          1
1 0.1294872</code></pre>
</div>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Résultats MARK</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>ms_model<span class="sc">$</span>results<span class="sc">$</span>real</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           estimate se lcl           ucl fixed note
S s1 g1 c1 a0 o1 t1       1.0000000  0   0  0.000000e+00           
S s2 g1 c1 a0 o1 t1       1.0000000  0   0  0.000000e+00           
S s3 g1 c1 a0 o1 t1       1.0000000  0   0  0.000000e+00           
S s4 g1 c1 a0 o1 t1       1.0000000  0   0  0.000000e+00           
S s5 g1 c1 a0 o1 t1       1.0000000  0   0  0.000000e+00           
p s1 g1 c1 a1 o1 t2       1.0000000  0   0  0.000000e+00           
Psi s1 to2 g1 c1 a0 o1 t1 0.1294872  0   1 3.309756e-309           
Psi s1 to3 g1 c1 a0 o1 t1 0.1294872  0   1 3.309756e-309           
Psi s1 to4 g1 c1 a0 o1 t1 0.1294872  0   1 3.309756e-309           
Psi s1 to5 g1 c1 a0 o1 t1 0.1294872  0   1 3.309756e-309           
Psi s2 to1 g1 c1 a0 o1 t1 0.0441176  0   1 1.026957e-309           
Psi s2 to3 g1 c1 a0 o1 t1 0.0441176  0   1 1.026957e-309           
Psi s2 to4 g1 c1 a0 o1 t1 0.0441176  0   1 1.026957e-309           
Psi s2 to5 g1 c1 a0 o1 t1 0.0441176  0   1 1.026957e-309           
Psi s3 to1 g1 c1 a0 o1 t1 0.0277778  0   1 6.357355e-310           
Psi s3 to2 g1 c1 a0 o1 t1 0.0277778  0   1 6.357355e-310           
Psi s3 to4 g1 c1 a0 o1 t1 0.0277778  0   1 6.357355e-310           
Psi s3 to5 g1 c1 a0 o1 t1 0.0277778  0   1 6.357355e-310           
Psi s4 to1 g1 c1 a0 o1 t1 0.1294872  0   1 3.309756e-309           
Psi s4 to2 g1 c1 a0 o1 t1 0.1294872  0   1 3.309756e-309           
Psi s4 to3 g1 c1 a0 o1 t1 0.1294872  0   1 3.309756e-309           
Psi s4 to5 g1 c1 a0 o1 t1 0.1294872  0   1 3.309756e-309           
Psi s5 to1 g1 c1 a0 o1 t1 0.1294872  0   1 3.309756e-309           
Psi s5 to2 g1 c1 a0 o1 t1 0.1294872  0   1 3.309756e-309           
Psi s5 to3 g1 c1 a0 o1 t1 0.1294872  0   1 3.309756e-309           
Psi s5 to4 g1 c1 a0 o1 t1 0.1294872  0   1 3.309756e-309           </code></pre>
</div>
</div>
</section>
<section id="vii_i.iii-transitions-session-2-3" class="level3">
<h3 class="anchored" data-anchor-id="vii_i.iii-transitions-session-2-3">VII_i.iii Transitions session 2 → 3</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="do">###MARK Session 2-3 ----</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Charger les données</span></span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data_original</span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Préparer les données phénologiques (sessions 2 et 3)</span></span>
<span id="cb147-10"><a href="#cb147-10" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb147-11"><a href="#cb147-11" aria-hidden="true" tabindex="-1"></a>phenology_codes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"j"</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"nf"</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">"f"</span> <span class="ot">=</span> <span class="dv">3</span>, <span class="st">"ff"</span> <span class="ot">=</span> <span class="dv">4</span>, <span class="st">"F"</span> <span class="ot">=</span> <span class="dv">5</span>)</span>
<span id="cb147-12"><a href="#cb147-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-13"><a href="#cb147-13" aria-hidden="true" tabindex="-1"></a>phenology_data_numeric <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb147-14"><a href="#cb147-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(ID_ind, phenoS2, phenoS3) <span class="sc">%&gt;%</span></span>
<span id="cb147-15"><a href="#cb147-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb147-16"><a href="#cb147-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">phenoS2 =</span> <span class="fu">as.character</span>(phenology_codes[phenoS2]),</span>
<span id="cb147-17"><a href="#cb147-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">phenoS3 =</span> <span class="fu">as.character</span>(phenology_codes[phenoS3])</span>
<span id="cb147-18"><a href="#cb147-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb147-19"><a href="#cb147-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Supprimer les individus avec NA dans phenoS2 ou phenoS3</span></span>
<span id="cb147-20"><a href="#cb147-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(phenoS2) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(phenoS3))</span>
<span id="cb147-21"><a href="#cb147-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-22"><a href="#cb147-22" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb147-23"><a href="#cb147-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Calcul empirique des transitions 2 → 3</span></span>
<span id="cb147-24"><a href="#cb147-24" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb147-25"><a href="#cb147-25" aria-hidden="true" tabindex="-1"></a>phenology_long <span class="ot">&lt;-</span> phenology_data_numeric <span class="sc">%&gt;%</span></span>
<span id="cb147-26"><a href="#cb147-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(phenoS2, phenoS3),</span>
<span id="cb147-27"><a href="#cb147-27" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"session"</span>,</span>
<span id="cb147-28"><a href="#cb147-28" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"state"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb147-29"><a href="#cb147-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">session =</span> <span class="fu">as.integer</span>(<span class="fu">gsub</span>(<span class="st">"phenoS"</span>, <span class="st">""</span>, session)))</span>
<span id="cb147-30"><a href="#cb147-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-31"><a href="#cb147-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Transitions successives</span></span>
<span id="cb147-32"><a href="#cb147-32" aria-hidden="true" tabindex="-1"></a>transitions <span class="ot">&lt;-</span> phenology_long <span class="sc">%&gt;%</span></span>
<span id="cb147-33"><a href="#cb147-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID_ind) <span class="sc">%&gt;%</span></span>
<span id="cb147-34"><a href="#cb147-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(session) <span class="sc">%&gt;%</span></span>
<span id="cb147-35"><a href="#cb147-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">next_state =</span> <span class="fu">lead</span>(state)) <span class="sc">%&gt;%</span></span>
<span id="cb147-36"><a href="#cb147-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(next_state)) <span class="sc">%&gt;%</span></span>
<span id="cb147-37"><a href="#cb147-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(state, next_state) <span class="sc">%&gt;%</span></span>
<span id="cb147-38"><a href="#cb147-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">%&gt;%</span></span>
<span id="cb147-39"><a href="#cb147-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n))</span>
<span id="cb147-40"><a href="#cb147-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-41"><a href="#cb147-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Créer la matrice 5x5</span></span>
<span id="cb147-42"><a href="#cb147-42" aria-hidden="true" tabindex="-1"></a>num_states <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb147-43"><a href="#cb147-43" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"j"</span>,<span class="st">"nf"</span>,<span class="st">"f"</span>,<span class="st">"ff"</span>,<span class="st">"F"</span>)</span>
<span id="cb147-44"><a href="#cb147-44" aria-hidden="true" tabindex="-1"></a>Psi_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow=</span>num_states, <span class="at">ncol=</span>num_states, <span class="at">dimnames =</span> <span class="fu">list</span>(states, states))</span>
<span id="cb147-45"><a href="#cb147-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-46"><a href="#cb147-46" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_states){</span>
<span id="cb147-47"><a href="#cb147-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_states){</span>
<span id="cb147-48"><a href="#cb147-48" aria-hidden="true" tabindex="-1"></a>    val <span class="ot">&lt;-</span> transitions <span class="sc">%&gt;%</span> <span class="fu">filter</span>(state <span class="sc">==</span> i, next_state <span class="sc">==</span> j) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(prob)</span>
<span id="cb147-49"><a href="#cb147-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(val) <span class="sc">&gt;</span> <span class="dv">0</span>) Psi_matrix[i,j] <span class="ot">&lt;-</span> <span class="fu">mean</span>(val)</span>
<span id="cb147-50"><a href="#cb147-50" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb147-51"><a href="#cb147-51" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb147-52"><a href="#cb147-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-53"><a href="#cb147-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalisation par ligne</span></span>
<span id="cb147-54"><a href="#cb147-54" aria-hidden="true" tabindex="-1"></a>Psi_matrix_norm <span class="ot">&lt;-</span> Psi_matrix <span class="sc">/</span> <span class="fu">rowSums</span>(Psi_matrix)</span>
<span id="cb147-55"><a href="#cb147-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-56"><a href="#cb147-56" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb147-57"><a href="#cb147-57" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Visualisation des transitions avec DiagrammeR</span></span>
<span id="cb147-58"><a href="#cb147-58" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb147-59"><a href="#cb147-59" aria-hidden="true" tabindex="-1"></a>dot_code <span class="ot">&lt;-</span> <span class="st">"digraph pheno_transitions { </span></span>
<span id="cb147-60"><a href="#cb147-60" aria-hidden="true" tabindex="-1"></a><span class="st">  rankdir=LR;</span></span>
<span id="cb147-61"><a href="#cb147-61" aria-hidden="true" tabindex="-1"></a><span class="st">  node [shape=circle, style=filled, color=lightblue, fontname=Helvetica];</span></span>
<span id="cb147-62"><a href="#cb147-62" aria-hidden="true" tabindex="-1"></a><span class="st">  j; nf; f; ff; F;</span></span>
<span id="cb147-63"><a href="#cb147-63" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span>
<span id="cb147-64"><a href="#cb147-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-65"><a href="#cb147-65" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_states){</span>
<span id="cb147-66"><a href="#cb147-66" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_states){</span>
<span id="cb147-67"><a href="#cb147-67" aria-hidden="true" tabindex="-1"></a>    prob <span class="ot">&lt;-</span> Psi_matrix_norm[i,j]</span>
<span id="cb147-68"><a href="#cb147-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(prob) <span class="sc">&amp;&amp;</span> prob <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb147-69"><a href="#cb147-69" aria-hidden="true" tabindex="-1"></a>      dot_code <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dot_code, states[i], <span class="st">" -&gt; "</span>, states[j], </span>
<span id="cb147-70"><a href="#cb147-70" aria-hidden="true" tabindex="-1"></a>                         <span class="st">" [label=</span><span class="sc">\"</span><span class="st">"</span>, <span class="fu">round</span>(prob, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\"</span><span class="st">];</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb147-71"><a href="#cb147-71" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb147-72"><a href="#cb147-72" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb147-73"><a href="#cb147-73" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb147-74"><a href="#cb147-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-75"><a href="#cb147-75" aria-hidden="true" tabindex="-1"></a>dot_code <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dot_code, <span class="st">"}"</span>)</span>
<span id="cb147-76"><a href="#cb147-76" aria-hidden="true" tabindex="-1"></a><span class="fu">grViz</span>(dot_code)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="grViz html-widget html-fill-item" id="htmlwidget-e5f1cec2059c2723f245" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-e5f1cec2059c2723f245">{"x":{"diagram":"digraph pheno_transitions { \n  rankdir=LR;\n  node [shape=circle, style=filled, color=lightblue, fontname=Helvetica];\n  j; nf; f; ff; F;\nj -> j [label=\"0.5\"];\nj -> nf [label=\"0.5\"];\nnf -> j [label=\"0.25\"];\nnf -> nf [label=\"0.25\"];\nnf -> ff [label=\"0.25\"];\nnf -> F [label=\"0.25\"];\nf -> ff [label=\"0.5\"];\nf -> F [label=\"0.5\"];\nff -> ff [label=\"1\"];\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Partie RMark</span></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Créer le champ "ch" pour MARK</span></span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>phenology_data_numeric <span class="ot">&lt;-</span> phenology_data_numeric <span class="sc">%&gt;%</span></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ch =</span> <span class="fu">paste0</span>(phenoS2, phenoS3))</span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Vérification</span></span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">nchar</span>(phenology_data_numeric<span class="sc">$</span>ch) <span class="sc">==</span> <span class="dv">2</span>))</span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Préparer les données pour RMark</span></span>
<span id="cb148-12"><a href="#cb148-12" aria-hidden="true" tabindex="-1"></a>ms_data <span class="ot">&lt;-</span> <span class="fu">process.data</span>(</span>
<span id="cb148-13"><a href="#cb148-13" aria-hidden="true" tabindex="-1"></a>  phenology_data_numeric,</span>
<span id="cb148-14"><a href="#cb148-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">"Multistrata"</span>,</span>
<span id="cb148-15"><a href="#cb148-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">strata.labels =</span> <span class="fu">c</span>(<span class="st">"1"</span>,<span class="st">"2"</span>,<span class="st">"3"</span>,<span class="st">"4"</span>,<span class="st">"5"</span>)</span>
<span id="cb148-16"><a href="#cb148-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-17"><a href="#cb148-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-18"><a href="#cb148-18" aria-hidden="true" tabindex="-1"></a>ms_ddl <span class="ot">&lt;-</span> <span class="fu">make.design.data</span>(ms_data)</span>
<span id="cb148-19"><a href="#cb148-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-20"><a href="#cb148-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Modèle Multistrata avec RMark</span></span>
<span id="cb148-21"><a href="#cb148-21" aria-hidden="true" tabindex="-1"></a>ms_model <span class="ot">&lt;-</span> <span class="fu">mark</span>(</span>
<span id="cb148-22"><a href="#cb148-22" aria-hidden="true" tabindex="-1"></a>  ms_data,</span>
<span id="cb148-23"><a href="#cb148-23" aria-hidden="true" tabindex="-1"></a>  ms_ddl,</span>
<span id="cb148-24"><a href="#cb148-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">model.parameters =</span> <span class="fu">list</span>(</span>
<span id="cb148-25"><a href="#cb148-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">Psi =</span> <span class="fu">list</span>(<span class="at">formula =</span> <span class="sc">~</span>stratum),</span>
<span id="cb148-26"><a href="#cb148-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">p =</span> <span class="fu">list</span>(<span class="at">formula =</span> <span class="sc">~</span><span class="dv">1</span>)</span>
<span id="cb148-27"><a href="#cb148-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb148-28"><a href="#cb148-28" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Note: only 2 parameters counted of 9 specified parameters</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>AICc and parameter count have been adjusted upward</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Output summary for Multistrata model
Name : S(~stratum)p(~1)Psi(~stratum) 

Npar :  9  (unadjusted=2)
-2lnL:  444.2665
AICc :  462.7328  (unadjusted=448.29701)

Beta
                   estimate se         lcl         ucl
S:(Intercept)    21.7179460  0  21.7179460  21.7179460
S:stratum2        8.1646101  0   8.1646101   8.1646101
S:stratum3        9.7880592  0   9.7880592   9.7880592
S:stratum4       -0.1713480  0  -0.1713480  -0.1713480
S:stratum5        0.0000000  0   0.0000000   0.0000000
p:(Intercept)    27.6016600  0  27.6016600  27.6016600
Psi:(Intercept)  -3.5308753  0  -3.5308753  -3.5308753
Psi:stratum2      0.0460912  0   0.0460912   0.0460912
Psi:stratum3     34.0437240  0  34.0437240  34.0437240
Psi:stratum4    -27.0744880  0 -27.0744880 -27.0744880
Psi:stratum5      0.0000000  0   0.0000000   0.0000000


Real Parameter S
 Stratum:1 
  1
1 1

 Stratum:2 
  1
1 1

 Stratum:3 
  1
1 1

 Stratum:4 
  1
1 1

 Stratum:5 
  1
1 1


Real Parameter p
 Stratum:1 
  2
1 1

 Stratum:2 
  2
1 1

 Stratum:3 
  2
1 1

 Stratum:4 
  2
1 1

 Stratum:5 
  2
1 1


Real Parameter Psi
 Stratum:1 To:2 
          1
1 0.0262097

 Stratum:1 To:3 
          1
1 0.0262097

 Stratum:1 To:4 
          1
1 0.0262097

 Stratum:1 To:5 
          1
1 0.0262097

 Stratum:2 To:1 
          1
1 0.0273109

 Stratum:2 To:3 
          1
1 0.0273109

 Stratum:2 To:4 
          1
1 0.0273109

 Stratum:2 To:5 
          1
1 0.0273109

 Stratum:3 To:1 
     1
1 0.25

 Stratum:3 To:2 
     1
1 0.25

 Stratum:3 To:4 
     1
1 0.25

 Stratum:3 To:5 
     1
1 0.25

 Stratum:4 To:1 
             1
1 5.108101e-14

 Stratum:4 To:2 
             1
1 5.108101e-14

 Stratum:4 To:3 
             1
1 5.108101e-14

 Stratum:4 To:5 
             1
1 5.108101e-14

 Stratum:5 To:1 
          1
1 0.0262097

 Stratum:5 To:2 
          1
1 0.0262097

 Stratum:5 To:3 
          1
1 0.0262097

 Stratum:5 To:4 
          1
1 0.0262097</code></pre>
</div>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Résultats MARK</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>ms_model<span class="sc">$</span>results<span class="sc">$</span>real</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                              estimate se lcl           ucl fixed note
S s1 g1 c1 a0 o1 t1       1.000000e+00  0   0  0.000000e+00           
S s2 g1 c1 a0 o1 t1       1.000000e+00  0   0  0.000000e+00           
S s3 g1 c1 a0 o1 t1       1.000000e+00  0   0  0.000000e+00           
S s4 g1 c1 a0 o1 t1       1.000000e+00  0   0  0.000000e+00           
S s5 g1 c1 a0 o1 t1       1.000000e+00  0   0  0.000000e+00           
p s1 g1 c1 a1 o1 t2       1.000000e+00  0   0  0.000000e+00           
Psi s1 to2 g1 c1 a0 o1 t1 2.620970e-02  0   1 5.988811e-310           
Psi s1 to3 g1 c1 a0 o1 t1 2.620970e-02  0   1 5.988811e-310           
Psi s1 to4 g1 c1 a0 o1 t1 2.620970e-02  0   1 5.988811e-310           
Psi s1 to5 g1 c1 a0 o1 t1 2.620970e-02  0   1 5.988811e-310           
Psi s2 to1 g1 c1 a0 o1 t1 2.731090e-02  0   1 6.247508e-310           
Psi s2 to3 g1 c1 a0 o1 t1 2.731090e-02  0   1 6.247508e-310           
Psi s2 to4 g1 c1 a0 o1 t1 2.731090e-02  0   1 6.247508e-310           
Psi s2 to5 g1 c1 a0 o1 t1 2.731090e-02  0   1 6.247508e-310           
Psi s3 to1 g1 c1 a0 o1 t1 2.500000e-01  0   1 7.416913e-309           
Psi s3 to2 g1 c1 a0 o1 t1 2.500000e-01  0   1 7.416913e-309           
Psi s3 to4 g1 c1 a0 o1 t1 2.500000e-01  0   1 7.416913e-309           
Psi s3 to5 g1 c1 a0 o1 t1 2.500000e-01  0   1 7.416913e-309           
Psi s4 to1 g1 c1 a0 o1 t1 5.108101e-14  0   0  0.000000e+00           
Psi s4 to2 g1 c1 a0 o1 t1 5.108101e-14  0   0  0.000000e+00           
Psi s4 to3 g1 c1 a0 o1 t1 5.108101e-14  0   0  0.000000e+00           
Psi s4 to5 g1 c1 a0 o1 t1 5.108101e-14  0   0  0.000000e+00           
Psi s5 to1 g1 c1 a0 o1 t1 2.620970e-02  0   1 5.988811e-310           
Psi s5 to2 g1 c1 a0 o1 t1 2.620970e-02  0   1 5.988811e-310           
Psi s5 to3 g1 c1 a0 o1 t1 2.620970e-02  0   1 5.988811e-310           
Psi s5 to4 g1 c1 a0 o1 t1 2.620970e-02  0   1 5.988811e-310           </code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="section-12" class="level1">
<h1>——————————-</h1>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>