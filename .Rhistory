S_herbacee = sum(S_herbacee > 0, na.rm = TRUE),
S_arbustive_basse = sum(S_arbustive_basse > 0, na.rm = TRUE),
S_arbustive_haute = sum(S_arbustive_haute > 0, na.rm = TRUE),
S_arborescente = sum(S_arborescente > 0, na.rm = TRUE),
.groups = "drop"
) %>%
pivot_longer(cols = everything(), names_to = "Strate", values_to = "Nb_individus")
# Regroupement par type de milieu
comptage_milieu <- comptage_strate %>%
mutate(Milieu = case_when(
Strate %in% milieux$ouvert ~ "Milieu ouvert",
Strate %in% milieux$semi_ouvert ~ "Milieu semi-ouvert",
Strate %in% milieux$ferme ~ "Milieu fermé"
)) %>%
group_by(Milieu) %>%
summarise(Nb_individus = sum(Nb_individus), .groups = "drop")
# Affichage
comptage_strate
comptage_milieu
library(dplyr)
library(tidyr)
# Définir les milieux
milieux <- list(
ouvert = c("S_muscinale", "S_herbacee"),
semi_ouvert = c("S_arbustive_basse"),
ferme = c("S_arbustive_haute", "S_arborescente")
)
# Déterminer la strate dominante pour chaque quadrat
tab_dominante <- tab_complet %>%
rowwise() %>%
mutate(
Strate_dominante = names(.)[which.max(c_across(S_muscinale:S_arborescente))]
) %>%
ungroup()
# Ajouter le type de milieu
tab_dominante <- tab_dominante %>%
mutate(
Milieu = case_when(
Strate_dominante %in% milieux$ouvert ~ "Milieu ouvert",
Strate_dominante %in% milieux$semi_ouvert ~ "Milieu semi-ouvert",
Strate_dominante %in% milieux$ferme ~ "Milieu fermé"
)
)
# Comptage du nombre d'individus par milieu
comptage_milieu <- tab_dominante %>%
group_by(Milieu) %>%
summarise(Nb_individus = n(), .groups = "drop")
# Affichage
tab_dominante %>% select(Strate_dominante, Milieu)
comptage_milieu
library(dplyr)
# Liste exacte des colonnes de recouvrement
strates <- c("S_muscinale", "S_herbacee", "S_arbustive_basse", "S_arbustive_haute", "S_arborescente")
# Définir les milieux
milieux <- list(
ouvert = c("S_muscinale", "S_herbacee"),
semi_ouvert = c("S_arbustive_basse"),
ferme = c("S_arbustive_haute", "S_arborescente")
)
# Identifier la strate dominante
tab_dominante <- tab_complet %>%
rowwise() %>%
mutate(
Strate_dominante = strates[which.max(c_across(all_of(strates)))]
) %>%
ungroup() %>%
mutate(
Milieu = case_when(
Strate_dominante %in% milieux$ouvert ~ "Milieu ouvert",
Strate_dominante %in% milieux$semi_ouvert ~ "Milieu semi-ouvert",
Strate_dominante %in% milieux$ferme ~ "Milieu fermé"
)
)
# Comptage des individus par milieu
comptage_milieu <- tab_dominante %>%
group_by(Milieu) %>%
summarise(Nb_individus = n(), .groups = "drop")
# Affichage
tab_dominante %>% select(Strate_dominante, Milieu)
comptage_milieu
View(tab_dominante)
library(ggplot2)
library(dplyr)
# Liste des colonnes de recouvrement
strates <- c("S_muscinale", "S_herbacee", "S_arbustive_basse", "S_arbustive_haute", "S_arborescente")
# Transformer en format long pour ggplot
tab_long <- tab_complet %>%
select(all_of(strates)) %>%
mutate(row_id = row_number()) %>%  # identifiant pour chaque individu
pivot_longer(
cols = all_of(strates),
names_to = "Strate",
values_to = "Recouvrement"
) %>%
filter(!is.na(Recouvrement))  # enlever les NA si présents
# Calculer l'abondance par indice de recouvrement
abondance <- tab_long %>%
group_by(Strate, Recouvrement) %>%
summarise(Nb_individus = n(), .groups = "drop")
# Graphique
ggplot(abondance, aes(x = Recouvrement, y = Nb_individus)) +
geom_bar(stat = "identity", fill = "skyblue") +
facet_wrap(~ Strate, scales = "free_y") +
theme_minimal(base_size = 14) +
labs(
title = "Abondance d'individus en fonction de l'indice de recouvrement",
x = "Indice de recouvrement",
y = "Nombre d'individus"
)
tab_complet
View(tab_complet)
# 1. Filtrer la session 2
tab_s2 <- tab_complet %>%
filter(session == 2)
# 2. Re-niveler la variable réponse
tab_s2$phenologie_verif <- relevel(
factor(tab_s2$phenologie_verif),
ref = "non_fleuri"
)
# 3. Modèle multinomial (identique)
mod_pheno_s2 <- multinom(
phenologie_verif ~ S_muscinale + S_herbacee + S_arbustive_basse +
S_arbustive_haute + S_arborescente,
data = tab_s2
)
# 4. Extraction des coefficients
coef_mat <- summary(mod_pheno_s2)$coefficients
se_mat   <- summary(mod_pheno_s2)$standard.errors
z_mat    <- coef_mat / se_mat
p_mat    <- 2 * (1 - pnorm(abs(z_mat)))
# 5. Fonction de significativité
etoiles <- function(p){
ifelse(p < 0.001, "***",
ifelse(p < 0.01, "**",
ifelse(p < 0.05, "*",
ifelse(p < 0.1, ".", ""))))
}
# 6. Tableau final
tableau_s2 <- data.frame(
Etat = rep(rownames(coef_mat), each = ncol(coef_mat)),
Parametre = rep(colnames(coef_mat), times = nrow(coef_mat)),
Coefficient = as.vector(coef_mat),
SE = as.vector(se_mat),
z = as.vector(z_mat),
p_value = as.vector(p_mat)
) %>%
mutate(
Coefficient = round(Coefficient, 4),
SE = round(SE, 4),
z = round(z, 3),
p_value = signif(p_value, 3),
Signif = etoiles(p_value)
)
# 7. Affichage
kable(
tableau_s2,
format = "html",
booktabs = TRUE,
caption = "Régression multinomiale (session 2) : effets des strates de recouvrement sur la phénologie"
) %>%
kable_styling(
full_width = FALSE,
bootstrap_options = c("striped", "hover")
)
# 1. Filtrer la session 2
tab_s3 <- tab_complet %>%
filter(session == 3)
# 2. Re-niveler la variable réponse
tab_s3$phenologie_verif <- relevel(
factor(tab_s3$phenologie_verif),
ref = "non_fleuri"
)
# 3. Modèle multinomial (identique)
mod_pheno_s3 <- multinom(
phenologie_verif ~ S_muscinale + S_herbacee + S_arbustive_basse +
S_arbustive_haute + S_arborescente,
data = tab_s3
)
# 4. Extraction des coefficients
coef_mat <- summary(mod_pheno_s3)$coefficients
se_mat   <- summary(mod_pheno_s3)$standard.errors
z_mat    <- coef_mat / se_mat
p_mat    <- 2 * (1 - pnorm(abs(z_mat)))
# 5. Fonction de significativité
etoiles <- function(p){
ifelse(p < 0.001, "***",
ifelse(p < 0.01, "**",
ifelse(p < 0.05, "*",
ifelse(p < 0.1, ".", ""))))
}
# 6. Tableau final
tableau_s3 <- data.frame(
Etat = rep(rownames(coef_mat), each = ncol(coef_mat)),
Parametre = rep(colnames(coef_mat), times = nrow(coef_mat)),
Coefficient = as.vector(coef_mat),
SE = as.vector(se_mat),
z = as.vector(z_mat),
p_value = as.vector(p_mat)
) %>%
mutate(
Coefficient = round(Coefficient, 4),
SE = round(SE, 4),
z = round(z, 3),
p_value = signif(p_value, 3),
Signif = etoiles(p_value)
)
# 7. Affichage
kable(
tableau_s3,
format = "html",
booktabs = TRUE,
caption = "Régression multinomiale (session 2) : effets des strates de recouvrement sur la phénologie"
) %>%
kable_styling(
full_width = FALSE,
bootstrap_options = c("striped", "hover")
)
# 1. Filtrer la session 2
tab_s2 <- tab_complet %>%
filter(session == 2)
# 2. Re-niveler la variable réponse
tab_s2$phenologie_verif <- relevel(
factor(tab_s2$phenologie_verif),
ref = "non_fleuri"
)
# 3. Modèle multinomial (identique)
mod_pheno_s2 <- multinom(
phenologie_verif ~ S_muscinale + S_herbacee + S_arbustive_basse +
S_arbustive_haute + S_arborescente,
data = tab_s2
)
# 4. Extraction des coefficients
coef_mat <- summary(mod_pheno_s2)$coefficients
se_mat   <- summary(mod_pheno_s2)$standard.errors
z_mat    <- coef_mat / se_mat
p_mat    <- 2 * (1 - pnorm(abs(z_mat)))
# 5. Fonction de significativité
etoiles <- function(p){
ifelse(p < 0.001, "***",
ifelse(p < 0.01, "**",
ifelse(p < 0.05, "*",
ifelse(p < 0.1, ".", ""))))
}
# 6. Tableau final
tableau_s2 <- data.frame(
Etat = rep(rownames(coef_mat), each = ncol(coef_mat)),
Parametre = rep(colnames(coef_mat), times = nrow(coef_mat)),
Coefficient = as.vector(coef_mat),
SE = as.vector(se_mat),
z = as.vector(z_mat),
p_value = as.vector(p_mat)
) %>%
mutate(
Coefficient = round(Coefficient, 4),
SE = round(SE, 4),
z = round(z, 3),
p_value = signif(p_value, 3),
Signif = etoiles(p_value)
)
# 7. Affichage
kable(
tableau_s2,
format = "html",
booktabs = TRUE,
caption = "Régression multinomiale (session 2) : effets des strates de recouvrement sur la phénologie"
) %>%
kable_styling(
full_width = FALSE,
bootstrap_options = c("striped", "hover")
)
View(phenologie_verif)
View(tab_s3)
View(phenologie_S1_S2)
View(phenologie_transi_tot)
View(data_original)
View(tab_complet)
View(data_original)
dt<- data_original
dt$phenoS2 <- relevel(
factor(dt$phenoS2),
ref = "nf"
)
View(tab_complet)
View(tab_complet)
# Ajouter les informations de detection dans la grille complete
tab_complet <- grille_complete %>%
left_join(
tab_detection %>%
mutate(detection = 1) %>%
dplyr::select(id_quadrat_fin, observateur, ID_ind, detection),
by = c("id_quadrat_fin", "observateur", "ID_ind")
) %>%
mutate(
detection = ifelse(is.na(detection), 0, detection)
)
tab_complet %>%
group_by(id_quadrat_fin, observateur) %>%
summarise(
n_detectes = sum(detection),
.groups = "drop"
) %>%
left_join(difference_ind, by = c("id_quadrat_fin", "observateur")) %>%
filter(n_detectes != n)
# Ajouter l'information des observateurs au tableau de détection
tab_complet <- tab_complet %>%
left_join(
tab_detection,
by = c("id_quadrat_fin","ID_ind", "observateur")
)
# Ajouter les informations aux données originales
data_original_obs <- data_original_obs %>%
mutate(id_quadrat_fin = paste(ID_quadrat, session, sep = "."))
tab_complet <- tab_complet %>%
left_join(
data_original_obs,
by = c("id_quadrat_fin","ID_ind"),
suffix = c("_test", "")
) %>%
dplyr::select(
-ends_with("_test")  # ou l’inverse selon ce que tu veux garder
) %>%
dplyr::select(id_ind_fin,id_quadrat_fin, ID_quadrat, ID_ind,site, quadrat, marquage, session,observateur, detection, phenologie_verif, phenologie, adequation, adequation_reel, taille)
# Extraire la partie quadrat de tab_complet (tout avant le dernier point)
tab_complet <- tab_complet %>%
mutate(
ID_Quadrat_clean = str_replace(id_quadrat_fin, "\\.[0-9]+$", "")
)
# Nettoyer recouvrement pour correspondre au format de tab_complet
recouvrement_clean <- recouvrement %>%
mutate(
ID_Quadrat_clean = str_replace_all(ID_Quadrat, "_", ".")
) %>%
dplyr::select(ID_Quadrat_clean, starts_with("S_"))
# Faire le left_join pour ajouter les colonnes S_ au tableau complet
tab_complet <- tab_complet %>%
left_join(recouvrement_clean, by = "ID_Quadrat_clean") %>%
dplyr::select(-ID_Quadrat_clean)
#Vérification histoires de capture
verif_sessions <- tab_complet %>%
group_by(ID_ind) %>%
summarise(
nb_sessions = n_distinct(session),
sessions = paste(sort(unique(session)), collapse = ","),
.groups = "drop"
)
check_sessions <- verif_sessions %>%
mutate(
ok_sessions = sessions == "1,2,3"
)
check_sessions %>%
filter(!ok_sessions)
View(tab_complet)
# 1. Filtrer la session 2
tab_s2 <- tab_complet %>%
filter(session == 2)
# 2. Re-niveler la variable réponse
tab_s2$phenologie_verif <- relevel(
factor(tab_s2$phenologie_verif),
ref = "non_fleuri"
)
# 3. Modèle multinomial (identique)
mod_pheno_s2 <- multinom(
phenologie_verif ~ S_muscinale + S_herbacee + S_arbustive_basse +
S_arbustive_haute + S_arborescente,
data = tab_s2
)
# 4. Extraction des coefficients
coef_mat <- summary(mod_pheno_s2)$coefficients
se_mat   <- summary(mod_pheno_s2)$standard.errors
z_mat    <- coef_mat / se_mat
# 5. Fonction de significativité
etoiles <- function(p){
ifelse(p < 0.001, "***",
ifelse(p < 0.01, "**",
ifelse(p < 0.05, "*",
ifelse(p < 0.1, ".", ""))))
}
# 6. Tableau final
tableau_s2 <- data.frame(
Etat = rep(rownames(coef_mat), each = ncol(coef_mat)),
Parametre = rep(colnames(coef_mat), times = nrow(coef_mat)),
Coefficient = as.vector(coef_mat),
SE = as.vector(se_mat),
z = as.vector(z_mat),
p_value = as.vector(p_mat)
) %>%
mutate(
Coefficient = round(Coefficient, 4),
SE = round(SE, 4),
z = round(z, 3),
p_value = signif(p_value, 3),
Signif = etoiles(p_value)
)
# 7. Affichage
kable(
tableau_s2,
format = "html",
booktabs = TRUE,
caption = "Régression multinomiale (session 2) : effets des strates de recouvrement sur la phénologie"
) %>%
kable_styling(
full_width = FALSE,
bootstrap_options = c("striped", "hover")
)
View(tab_s2)
# 1. Filtrer la session 2
tab_s2 <- tab_complet %>%
filter(session == 2)
# 2. Re-niveler la variable réponse
tab_s2$phenologie_verif <- relevel(
factor(tab_s2$phenologie_verif),
ref = "non_fleuri"
)
# 3. Modèle multinomial (identique)
mod_pheno_s2 <- multinom(
phenologie_verif ~ S_muscinale + S_herbacee + S_arbustive_basse +
S_arbustive_haute + S_arborescente,
data = tab_s2
)
# 4. Extraction des coefficients
coef_mat <- summary(mod_pheno_s2)$coefficients
se_mat   <- summary(mod_pheno_s2)$standard.errors
z_mat    <- coef_mat / se_mat
p_mat    <- 2 * (1 - pnorm(abs(z_mat)))
# 5. Fonction de significativité
etoiles <- function(p){
ifelse(p < 0.001, "***",
ifelse(p < 0.01, "**",
ifelse(p < 0.05, "*",
ifelse(p < 0.1, ".", ""))))
}
# 6. Tableau final
tableau_s2 <- data.frame(
Etat = rep(rownames(coef_mat), each = ncol(coef_mat)),
Parametre = rep(colnames(coef_mat), times = nrow(coef_mat)),
Coefficient = as.vector(coef_mat),
SE = as.vector(se_mat),
z = as.vector(z_mat),
p_value = as.vector(p_mat)
) %>%
mutate(
Coefficient = round(Coefficient, 4),
SE = round(SE, 4),
z = round(z, 3),
p_value = signif(p_value, 3),
Signif = etoiles(p_value)
)
# 7. Affichage
kable(
tableau_s2,
format = "html",
booktabs = TRUE,
caption = "Régression multinomiale (session 2) : effets des strates de recouvrement sur la phénologie"
) %>%
kable_styling(
full_width = FALSE,
bootstrap_options = c("striped", "hover")
)
# 1. Filtrer la session 2
tab_s3 <- tab_complet %>%
filter(session == 3)
# 2. Re-niveler la variable réponse
tab_s3$phenologie_verif <- relevel(
factor(tab_s3$phenologie_verif),
ref = "non_fleuri"
)
# 3. Modèle multinomial (identique)
mod_pheno_s3 <- multinom(
phenologie_verif ~ S_muscinale + S_herbacee + S_arbustive_basse +
S_arbustive_haute + S_arborescente,
data = tab_s3
)
# 4. Extraction des coefficients
coef_mat <- summary(mod_pheno_s3)$coefficients
se_mat   <- summary(mod_pheno_s3)$standard.errors
z_mat    <- coef_mat / se_mat
p_mat    <- 2 * (1 - pnorm(abs(z_mat)))
# 5. Fonction de significativité
etoiles <- function(p){
ifelse(p < 0.001, "***",
ifelse(p < 0.01, "**",
ifelse(p < 0.05, "*",
ifelse(p < 0.1, ".", ""))))
}
# 6. Tableau final
tableau_s3 <- data.frame(
Etat = rep(rownames(coef_mat), each = ncol(coef_mat)),
Parametre = rep(colnames(coef_mat), times = nrow(coef_mat)),
Coefficient = as.vector(coef_mat),
SE = as.vector(se_mat),
z = as.vector(z_mat),
p_value = as.vector(p_mat)
) %>%
mutate(
Coefficient = round(Coefficient, 4),
SE = round(SE, 4),
z = round(z, 3),
p_value = signif(p_value, 3),
Signif = etoiles(p_value)
)
# 7. Affichage
kable(
tableau_s3,
format = "html",
booktabs = TRUE,
caption = "Régression multinomiale (session 2) : effets des strates de recouvrement sur la phénologie"
) %>%
kable_styling(
full_width = FALSE,
bootstrap_options = c("striped", "hover")
)
View(tab_complet)
